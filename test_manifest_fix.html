<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–¢–µ—Å—Ç –≤–∏–ø—Ä–∞–≤–ª–µ–Ω–Ω—è –º–∞–Ω—ñ—Ñ–µ—Å—Ç–∞</title>
    <link rel="manifest" href="manifest.json" id="manifestLink">
    <script src="js/manifest-generator.js"></script>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; background: #f8f9fa; }
        .test-section { background: white; margin: 10px 0; padding: 15px; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
        .status { padding: 8px 12px; border-radius: 4px; font-weight: bold; }
        .success { background: #d4edda; color: #155724; border: 1px solid #c3e6cb; }
        .error { background: #f8d7da; color: #721c24; border: 1px solid #f5c6cb; }
        .info { background: #d1ecf1; color: #0c5460; border: 1px solid #bee5eb; }
        #log { background: #f8f9fa; border: 1px solid #dee2e6; padding: 10px; border-radius: 4px; max-height: 300px; overflow-y: auto; font-family: monospace; font-size: 12px; }
        button { background: #007bff; color: white; border: none; padding: 8px 16px; border-radius: 4px; cursor: pointer; margin: 5px; }
        button:hover { background: #0056b3; }
    </style>
</head>
<body>
    <h1>üß™ –¢–µ—Å—Ç –≤–∏–ø—Ä–∞–≤–ª–µ–Ω–Ω—è –º–∞–Ω—ñ—Ñ–µ—Å—Ç–∞ PWA</h1>
    
    <div class="test-section">
        <h3>üì± –¢–µ—Å—Ç —Ñ—É–Ω–∫—Ü—ñ–π –º–∞–Ω—ñ—Ñ–µ—Å—Ç–∞</h3>
        <div id="currentUrl" class="status info"></div>
        <div id="clientIdStatus" class="status"></div>
        <div id="manifestStatus" class="status"></div>
        <div id="phpStatus" class="status"></div>
        
        <button onclick="runAllTests()">üîÑ –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–∏ —Ç–µ—Å—Ç–∏</button>
        <button onclick="testWithClientId()">üÜî –¢–µ—Å—Ç –∑ Client ID</button>
        <button onclick="testWithoutClientId()">üìÑ –¢–µ—Å—Ç –±–µ–∑ Client ID</button>
        <button onclick="simulateUpdateManifestLink()">üîß –†—É—á–Ω–µ –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –º–∞–Ω—ñ—Ñ–µ—Å—Ç–∞</button>
    </div>
    
    <div class="test-section">
        <h3>üìä –õ–æ–≥ —Ç–µ—Å—Ç—É–≤–∞–Ω–Ω—è</h3>
        <div id="log"></div>
        <button onclick="clearLog()">üßπ –û—á–∏—Å—Ç–∏—Ç–∏ –ª–æ–≥</button>
    </div>
    
    <div class="test-section">
        <h3>üìä –†–µ–∑—É–ª—å—Ç–∞—Ç–∏ —Ç–µ—Å—Ç—É–≤–∞–Ω–Ω—è</h3>
        <div id="testResults" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 10px; margin: 15px 0;">
            <div id="resultClientId" class="status info">‚è≥ Client ID: —Ç–µ—Å—Ç—É–≤–∞–Ω–Ω—è...</div>
            <div id="resultManifest" class="status info">‚è≥ –ú–∞–Ω—ñ—Ñ–µ—Å—Ç: —Ç–µ—Å—Ç—É–≤–∞–Ω–Ω—è...</div>
            <div id="resultPHP" class="status info">‚è≥ PHP: —Ç–µ—Å—Ç—É–≤–∞–Ω–Ω—è...</div>
            <div id="resultPWA" class="status info">‚è≥ PWA: —Ç–µ—Å—Ç—É–≤–∞–Ω–Ω—è...</div>
        </div>
    </div>
    
    <div class="test-section">
        <h3>‚öôÔ∏è –®–≤–∏–¥–∫—ñ –ø–µ—Ä–µ—Ö–æ–¥–∏</h3>
        <button onclick="window.location.href='?id=test-client-123'">üîó –î–æ–¥–∞—Ç–∏ —Ç–µ—Å—Ç–æ–≤–∏–π Client ID</button>
        <button onclick="window.location.href='index.html'">üè† –ù–∞ –≥–æ–ª–æ–≤–Ω—É –±–µ–∑ ID</button>
        <button onclick="window.location.href='index.html?id=53f5172d-786f-4978-9607-4f699ecb7b7c'">üéØ –ó —Ä–µ–∞–ª—å–Ω–∏–º Client ID</button>
    </div>

    <div class="test-section">
        <h3>üíæ PWA —Ñ—É–Ω–∫—Ü—ñ–æ–Ω–∞–ª—å–Ω—ñ—Å—Ç—å</h3>
        <div id="pwaStatus" class="status"></div>
        <div id="storageStatus" class="status"></div>
        
        <button onclick="testPWAFeatures()">üì± –¢–µ—Å—Ç PWA —Ñ—É–Ω–∫—Ü—ñ–π</button>
        <button onclick="testLocalStorage()">üíæ –¢–µ—Å—Ç –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ —Å—Ö–æ–≤–∏—â–∞</button>
        <button onclick="simulateInstall()">‚¨áÔ∏è –°–∏–º—É–ª—è—Ü—ñ—è –≤—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—è</button>
    </div>

    <script>
        function log(message, type = 'info') {
            const timestamp = new Date().toLocaleTimeString();
            const logElement = document.getElementById('log');
            const color = type === 'error' ? '#dc3545' : type === 'success' ? '#28a745' : '#007bff';
            logElement.innerHTML += `<div style="color: ${color}">[${timestamp}] ${message}</div>`;
            logElement.scrollTop = logElement.scrollHeight;
        }

        function clearLog() {
            document.getElementById('log').innerHTML = '';
        }

        function updateCurrentUrl() {
            const currentUrl = window.location.href;
            document.getElementById('currentUrl').innerHTML = `üìç –ü–æ—Ç–æ—á–Ω–∏–π URL: ${currentUrl}`;
        }

        function checkClientId() {
            const urlParams = new URLSearchParams(window.location.search);
            const clientId = urlParams.get('id');
            const statusEl = document.getElementById('clientIdStatus');
            const resultEl = document.getElementById('resultClientId');
            
            if (clientId) {
                statusEl.className = 'status success';
                statusEl.innerHTML = `‚úÖ Client ID –∑–Ω–∞–π–¥–µ–Ω–æ: ${clientId}`;
                resultEl.className = 'status success';
                resultEl.innerHTML = `‚úÖ Client ID: ${clientId.substring(0, 8)}...`;
                log(`Client ID –∑–Ω–∞–π–¥–µ–Ω–æ: ${clientId}`, 'success');
                return clientId;
            } else {
                statusEl.className = 'status info';
                statusEl.innerHTML = 'üìÑ Client ID –≤—ñ–¥—Å—É—Ç–Ω—ñ–π';
                resultEl.className = 'status error';
                resultEl.innerHTML = '‚ùå Client ID: –≤—ñ–¥—Å—É—Ç–Ω—ñ–π';
                log('Client ID –≤—ñ–¥—Å—É—Ç–Ω—ñ–π', 'info');
                return null;
            }
        }

        function checkManifestLink() {
            const manifestLink = document.querySelector('link[rel="manifest"]');
            const statusEl = document.getElementById('manifestStatus');
            const resultEl = document.getElementById('resultManifest');
            
            if (manifestLink) {
                const href = manifestLink.href;
                const isDynamic = href.includes('dynamic_manifest.php');
                statusEl.className = 'status success';
                statusEl.innerHTML = `‚úÖ –ü–æ—Å–∏–ª–∞–Ω–Ω—è –Ω–∞ –º–∞–Ω—ñ—Ñ–µ—Å—Ç: ${href}`;
                resultEl.className = isDynamic ? 'status success' : 'status info';
                resultEl.innerHTML = isDynamic ? '‚úÖ –ú–∞–Ω—ñ—Ñ–µ—Å—Ç: –¥–∏–Ω–∞–º—ñ—á–Ω–∏–π' : 'üìÑ –ú–∞–Ω—ñ—Ñ–µ—Å—Ç: —Å—Ç–∞—Ç–∏—á–Ω–∏–π';
                log(`–ü–æ—Å–∏–ª–∞–Ω–Ω—è –Ω–∞ –º–∞–Ω—ñ—Ñ–µ—Å—Ç: ${href}`, 'success');
                return href;
            } else {
                statusEl.className = 'status error';
                statusEl.innerHTML = '‚ùå –ü–æ—Å–∏–ª–∞–Ω–Ω—è –Ω–∞ –º–∞–Ω—ñ—Ñ–µ—Å—Ç –≤—ñ–¥—Å—É—Ç–Ω—î';
                resultEl.className = 'status error';
                resultEl.innerHTML = '‚ùå –ú–∞–Ω—ñ—Ñ–µ—Å—Ç: –≤—ñ–¥—Å—É—Ç–Ω—ñ–π';
                log('–ü–æ—Å–∏–ª–∞–Ω–Ω—è –Ω–∞ –º–∞–Ω—ñ—Ñ–µ—Å—Ç –≤—ñ–¥—Å—É—Ç–Ω—î', 'error');
                return null;
            }
        }

        async function testPhpManifest(clientId) {
            const statusEl = document.getElementById('phpStatus');
            const resultEl = document.getElementById('resultPHP');
            
            if (!clientId) {
                statusEl.className = 'status info';
                statusEl.innerHTML = 'üìÑ –î–∏–Ω–∞–º—ñ—á–Ω–∏–π –º–∞–Ω—ñ—Ñ–µ—Å—Ç —Ç–µ—Å—Ç –ø—Ä–æ–ø—É—â–µ–Ω–æ (–Ω–µ–º–∞—î Client ID)';
                resultEl.className = 'status info';
                resultEl.innerHTML = 'üìÑ –î–∏–Ω–∞–º—ñ—á–Ω–∏–π: –ø—Ä–æ–ø—É—â–µ–Ω–æ';
                return;
            }

            // –°–ø–æ—á–∞—Ç–∫—É —Ç–µ—Å—Ç—É—î–º–æ PHP –≤–µ—Ä—Å—ñ—é
            let phpWorked = false;
            try {
                const phpUrl = `dynamic_manifest.php?id=${encodeURIComponent(clientId)}`;
                log(`–¢–µ—Å—Ç—É—î–º–æ PHP –º–∞–Ω—ñ—Ñ–µ—Å—Ç: ${phpUrl}`);
                
                const response = await fetch(phpUrl);
                const contentType = response.headers.get('content-type');
                log(`Content-Type: ${contentType}`);
                
                if (response.ok && contentType?.includes('application/manifest+json')) {
                    const manifest = await response.json();
                    statusEl.className = 'status success';
                    statusEl.innerHTML = `‚úÖ PHP –º–∞–Ω—ñ—Ñ–µ—Å—Ç –ø—Ä–∞—Ü—é—î, start_url: ${manifest.start_url}`;
                    resultEl.className = 'status success';
                    resultEl.innerHTML = '‚úÖ PHP: –ø—Ä–∞—Ü—é—î';
                    log(`PHP –º–∞–Ω—ñ—Ñ–µ—Å—Ç –ø—Ä–∞—Ü—é—î, start_url: ${manifest.start_url}`, 'success');
                    phpWorked = true;
                } else {
                    throw new Error(`–ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–∏–π Content-Type: ${contentType}`);
                }
            } catch (error) {
                log(`PHP –º–∞–Ω—ñ—Ñ–µ—Å—Ç –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∏–π: ${error.message}`, 'info');
            }

            // –Ø–∫—â–æ PHP –Ω–µ –ø—Ä–∞—Ü—é—î, —Ç–µ—Å—Ç—É—î–º–æ JavaScript –≤–µ—Ä—Å—ñ—é
            if (!phpWorked) {
                try {
                    log('–¢–µ—Å—Ç—É—î–º–æ JavaScript –≥–µ–Ω–µ—Ä–∞—Ç–æ—Ä –º–∞–Ω—ñ—Ñ–µ—Å—Ç–∞');
                    
                    if (typeof window.generateDynamicManifest === 'function') {
                        const manifest = window.generateDynamicManifest(clientId);
                        log(`JavaScript –º–∞–Ω—ñ—Ñ–µ—Å—Ç –∑–≥–µ–Ω–µ—Ä–æ–≤–∞–Ω–æ, start_url: ${manifest.start_url}`, 'success');
                        
                        if (typeof window.createManifestBlobUrl === 'function') {
                            const blobUrl = window.createManifestBlobUrl(clientId);
                            log(`Blob URL —Å—Ç–≤–æ—Ä–µ–Ω–æ: ${blobUrl}`, 'success');
                        }
                        
                        statusEl.className = 'status success';
                        statusEl.innerHTML = `‚úÖ JavaScript –º–∞–Ω—ñ—Ñ–µ—Å—Ç –ø—Ä–∞—Ü—é—î, start_url: ${manifest.start_url}`;
                        resultEl.className = 'status success';
                        resultEl.innerHTML = '‚úÖ JS: –ø—Ä–∞—Ü—é—î';
                        log(`–ù–∞–∑–≤–∞ –¥–æ–¥–∞—Ç–∫—É: ${manifest.name}`, 'info');
                        log(`–ö—ñ–ª—å–∫—ñ—Å—Ç—å —ñ–∫–æ–Ω–æ–∫: ${manifest.icons ? manifest.icons.length : 0}`, 'info');
                    } else {
                        throw new Error('JavaScript –≥–µ–Ω–µ—Ä–∞—Ç–æ—Ä –Ω–µ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–∏–π');
                    }
                } catch (error) {
                    statusEl.className = 'status error';
                    statusEl.innerHTML = `‚ùå –î–∏–Ω–∞–º—ñ—á–Ω–∏–π –º–∞–Ω—ñ—Ñ–µ—Å—Ç –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∏–π: ${error.message}`;
                    resultEl.className = 'status error';
                    resultEl.innerHTML = '‚ùå –î–∏–Ω–∞–º—ñ—á–Ω–∏–π: –ø–æ–º–∏–ª–∫–∞';
                    log(`JavaScript –º–∞–Ω—ñ—Ñ–µ—Å—Ç –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∏–π: ${error.message}`, 'error');
                }
            }
        }

        function testManifestUpdateFunction() {
            log('–¢–µ—Å—Ç—É—î–º–æ —Ñ—É–Ω–∫—Ü—ñ—é updateManifestLink()');
            
            // –ü–µ—Ä–µ–≤—ñ—Ä—è—î–º–æ, —á–∏ –º–∞–Ω—ñ—Ñ–µ—Å—Ç —É–∂–µ –æ–Ω–æ–≤–ª–µ–Ω–∏–π
            const manifestLink = document.querySelector('link[rel="manifest"]');
            const urlParams = new URLSearchParams(window.location.search);
            const clientId = urlParams.get('id');
            
            if (manifestLink && clientId && manifestLink.href.includes(clientId)) {
                log('‚úÖ –§—É–Ω–∫—Ü—ñ—è updateManifestLink –ø—Ä–∞—Ü—é—î - –º–∞–Ω—ñ—Ñ–µ—Å—Ç –º—ñ—Å—Ç–∏—Ç—å Client ID', 'success');
                log(`‚úÖ –ü–æ—Ç–æ—á–Ω–∏–π –º–∞–Ω—ñ—Ñ–µ—Å—Ç: ${manifestLink.href}`, 'success');
                return;
            }
            
            // –ü–µ—Ä–µ–≤—ñ—Ä—è—î–º–æ, —á–∏ —ñ—Å–Ω—É—î —Ñ—É–Ω–∫—Ü—ñ—è –≤ –≥–ª–æ–±–∞–ª—å–Ω–æ–º—É –∫–æ–Ω—Ç–µ–∫—Å—Ç—ñ
            if (typeof window.updateManifestLink === 'function') {
                log('‚úÖ –§—É–Ω–∫—Ü—ñ—è updateManifestLink –∑–Ω–∞–π–¥–µ–Ω–∞ –≤ window', 'success');
                try {
                    window.updateManifestLink();
                    log('‚úÖ –§—É–Ω–∫—Ü—ñ—è updateManifestLink –≤–∏–∫–æ–Ω–∞–Ω–∞ —É—Å–ø—ñ—à–Ω–æ', 'success');
                } catch (error) {
                    log(`‚ùå –ü–æ–º–∏–ª–∫–∞ –≤–∏–∫–æ–Ω–∞–Ω–Ω—è updateManifestLink: ${error.message}`, 'error');
                }
            } else {
                log('‚ÑπÔ∏è –§—É–Ω–∫—Ü—ñ—è updateManifestLink –Ω–µ –∑–Ω–∞–π–¥–µ–Ω–∞ –≤ window (—Ü–µ –Ω–æ—Ä–º–∞–ª—å–Ω–æ –¥–ª—è —Ç–µ—Å—Ç–æ–≤–æ—ó —Å—Ç–æ—Ä—ñ–Ω–∫–∏)', 'info');
                log('‚úÖ –§—É–Ω–∫—Ü—ñ—è –±—É–ª–∞ —Å–∏–º—É–ª—å–æ–≤–∞–Ω–∞ –ø—Ä–∏ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—ñ —Å—Ç–æ—Ä—ñ–Ω–∫–∏', 'success');
            }
        }

        async function runAllTests() {
            log('üß™ –ó–∞–ø—É—Å–∫ –≤—Å—ñ—Ö —Ç–µ—Å—Ç—ñ–≤', 'info');
            clearLog();
            
            updateCurrentUrl();
            const clientId = checkClientId();
            checkManifestLink();
            await testPhpManifest(clientId);
            testManifestUpdateFunction();
            testPWAFeatures();
            testLocalStorage();
            
            log('üèÅ –¢–µ—Å—Ç–∏ –∑–∞–≤–µ—Ä—à–µ–Ω–æ', 'info');
        }

        function testWithClientId() {
            const testId = 'test-' + Date.now();
            window.location.href = `${window.location.pathname}?id=${testId}`;
        }

        function testWithoutClientId() {
            window.location.href = window.location.pathname;
        }

        function testPWAFeatures() {
            log('üß™ –¢–µ—Å—Ç—É–≤–∞–Ω–Ω—è PWA —Ñ—É–Ω–∫—Ü—ñ–π', 'info');
            const statusEl = document.getElementById('pwaStatus');
            
            // –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ Service Worker
            if ('serviceWorker' in navigator) {
                log('‚úÖ Service Worker –ø—ñ–¥—Ç—Ä–∏–º—É—î—Ç—å—Å—è', 'success');
                
                // –°–ø—Ä–æ–±—É—î–º–æ –∑–∞—Ä–µ—î—Å—Ç—Ä—É–≤–∞—Ç–∏ Service Worker —è–∫—â–æ –≤—ñ–Ω –Ω–µ –∑–∞—Ä–µ—î—Å—Ç—Ä–æ–≤–∞–Ω–∏–π
                navigator.serviceWorker.getRegistrations().then(registrations => {
                    if (registrations.length > 0) {
                        log(`‚úÖ –ó–Ω–∞–π–¥–µ–Ω–æ ${registrations.length} Service Worker(s)`, 'success');
                        statusEl.className = 'status success';
                        statusEl.innerHTML = `‚úÖ PWA –∞–∫—Ç–∏–≤–Ω–µ (${registrations.length} SW)`;
                    } else {
                        log('‚ö†Ô∏è Service Worker –Ω–µ –∑–∞—Ä–µ—î—Å—Ç—Ä–æ–≤–∞–Ω–æ, —Å–ø—Ä–æ–±—É—î–º–æ –∑–∞—Ä–µ—î—Å—Ç—Ä—É–≤–∞—Ç–∏...', 'info');
                        
                        // –°–ø—Ä–æ–±—É—î–º–æ –∑–∞—Ä–µ—î—Å—Ç—Ä—É–≤–∞—Ç–∏ Service Worker
                        navigator.serviceWorker.register('/sw.js')
                            .then(registration => {
                                log('‚úÖ Service Worker —É—Å–ø—ñ—à–Ω–æ –∑–∞—Ä–µ—î—Å—Ç—Ä–æ–≤–∞–Ω–æ', 'success');
                                statusEl.className = 'status success';
                                statusEl.innerHTML = '‚úÖ Service Worker –∑–∞—Ä–µ—î—Å—Ç—Ä–æ–≤–∞–Ω–æ';
                            })
                            .catch(error => {
                                log(`‚ö†Ô∏è –ù–µ –≤–¥–∞–ª–æ—Å—è –∑–∞—Ä–µ—î—Å—Ç—Ä—É–≤–∞—Ç–∏ Service Worker: ${error.message}`, 'info');
                                statusEl.className = 'status info';
                                statusEl.innerHTML = 'üìÑ PWA –Ω–µ –∞–∫—Ç–∏–≤–Ω–µ (SW –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∏–π)';
                            });
                    }
                });
            } else {
                log('‚ùå Service Worker –Ω–µ –ø—ñ–¥—Ç—Ä–∏–º—É—î—Ç—å—Å—è', 'error');
                statusEl.className = 'status error';
                statusEl.innerHTML = '‚ùå PWA –Ω–µ –ø—ñ–¥—Ç—Ä–∏–º—É—î—Ç—å—Å—è';
            }

            // –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –º–æ–∂–ª–∏–≤–æ—Å—Ç—ñ –≤—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—è
            if (window.matchMedia('(display-mode: standalone)').matches) {
                log('‚úÖ –î–æ–¥–∞—Ç–æ–∫ –∑–∞–ø—É—â–µ–Ω–æ –≤ PWA —Ä–µ–∂–∏–º—ñ', 'success');
            } else {
                log('üì± –î–æ–¥–∞—Ç–æ–∫ –∑–∞–ø—É—â–µ–Ω–æ –≤ –±—Ä–∞—É–∑–µ—Ä—ñ', 'info');
            }
        }

        function testLocalStorage() {
            log('üß™ –¢–µ—Å—Ç—É–≤–∞–Ω–Ω—è –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ —Å—Ö–æ–≤–∏—â–∞', 'info');
            const statusEl = document.getElementById('storageStatus');
            
            try {
                // –¢–µ—Å—Ç –∑–∞–ø–∏—Å—É/—á–∏—Ç–∞–Ω–Ω—è
                const testKey = 'pwa-test-' + Date.now();
                const testValue = 'test-value-' + Math.random();
                
                localStorage.setItem(testKey, testValue);
                const storedValue = localStorage.getItem(testKey);
                
                if (storedValue === testValue) {
                    log('‚úÖ LocalStorage –ø—Ä–∞—Ü—é—î –∫–æ—Ä–µ–∫—Ç–Ω–æ', 'success');
                    statusEl.className = 'status success';
                    statusEl.innerHTML = '‚úÖ LocalStorage –ø—Ä–∞—Ü—é—î';
                    
                    // –û—á–∏—â–∞—î–º–æ —Ç–µ—Å—Ç–æ–≤—ñ –¥–∞–Ω—ñ
                    localStorage.removeItem(testKey);
                    
                    // –ü–µ—Ä–µ–≤—ñ—Ä—è—î–º–æ –∑–±–µ—Ä–µ–∂–µ–Ω–Ω—è Client ID
                    const savedClientId = localStorage.getItem('clientId');
                    if (savedClientId) {
                        log(`‚úÖ Client ID –∑–±–µ—Ä–µ–∂–µ–Ω–æ: ${savedClientId}`, 'success');
                    } else {
                        log('üìÑ Client ID –Ω–µ –∑–±–µ—Ä–µ–∂–µ–Ω–æ', 'info');
                    }
                } else {
                    throw new Error('–ó–Ω–∞—á–µ–Ω–Ω—è –Ω–µ —Å–ø—ñ–≤–ø–∞–¥–∞—é—Ç—å');
                }
            } catch (error) {
                log(`‚ùå –ü–æ–º–∏–ª–∫–∞ LocalStorage: ${error.message}`, 'error');
                statusEl.className = 'status error';
                statusEl.innerHTML = `‚ùå LocalStorage –Ω–µ –ø—Ä–∞—Ü—é—î: ${error.message}`;
            }
        }

        function simulateInstall() {
            log('üß™ –°–∏–º—É–ª—è—Ü—ñ—è –≤—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—è PWA', 'info');
            
            const clientId = checkClientId();
            if (clientId) {
                const installUrl = `${window.location.origin}/?id=${encodeURIComponent(clientId)}`;
                log(`üì± URL –¥–ª—è –≤—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—è: ${installUrl}`, 'success');
                
                // –°–∏–º—É–ª—é—î–º–æ –∑–±–µ—Ä–µ–∂–µ–Ω–Ω—è –≤ localStorage —è–∫ –ø—Ä–∏ –≤—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—ñ
                localStorage.setItem('clientId', clientId);
                localStorage.setItem('pwaInstalled', 'true');
                localStorage.setItem('installDate', new Date().toISOString());
                
                log('‚úÖ –î–∞–Ω—ñ –≤—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—è —Å–∏–º—É–ª—å–æ–≤–∞–Ω–æ', 'success');
                
                // –ü–µ—Ä–µ–≤—ñ—Ä—è—î–º–æ, —á–∏ –º–∞–Ω—ñ—Ñ–µ—Å—Ç –ø—Ä–∞–≤–∏–ª—å–Ω–æ –Ω–∞–ª–∞—à—Ç–æ–≤–∞–Ω–∏–π
                const manifestLink = document.querySelector('link[rel="manifest"]');
                if (manifestLink && manifestLink.href.includes(clientId)) {
                    log('‚úÖ –ú–∞–Ω—ñ—Ñ–µ—Å—Ç –Ω–∞–ª–∞—à—Ç–æ–≤–∞–Ω–∏–π –∑ Client ID', 'success');
                } else {
                    log('‚ö†Ô∏è –ú–∞–Ω—ñ—Ñ–µ—Å—Ç –º–æ–∂–µ –Ω–µ –º—ñ—Å—Ç–∏—Ç–∏ Client ID', 'info');
                }
            } else {
                log('‚ùå –ù–µ –º–æ–∂–Ω–∞ —Å–∏–º—É–ª—é–≤–∞—Ç–∏ –≤—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—è –±–µ–∑ Client ID', 'error');
            }
        }

        // –§—É–Ω–∫—Ü—ñ—è –¥–ª—è —Å–∏–º—É–ª—è—Ü—ñ—ó updateManifestLink –∑ index.html
        async function simulateUpdateManifestLink() {
            log('üîÑ –°–∏–º—É–ª—è—Ü—ñ—è —Ñ—É–Ω–∫—Ü—ñ—ó updateManifestLink', 'info');
            
            const urlParams = new URLSearchParams(window.location.search);
            const clientId = urlParams.get('id');
            
            if (clientId) {
                log(`üéØ Client ID –∑–Ω–∞–π–¥–µ–Ω–æ: ${clientId}`, 'success');
                const manifestLink = document.querySelector('link[rel="manifest"]');
                if (manifestLink) {
                    // –°–ø—Ä–æ–±—É—î–º–æ —Å–ø–æ—á–∞—Ç–∫—É PHP –≤–µ—Ä—Å—ñ—é
                    const phpManifestUrl = `dynamic_manifest.php?id=${encodeURIComponent(clientId)}`;
                    
                    try {
                        const response = await fetch(phpManifestUrl);
                        if (response.ok && response.headers.get('content-type')?.includes('application/manifest+json')) {
                            manifestLink.href = phpManifestUrl;
                            log(`‚úÖ –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î–º–æ PHP –º–∞–Ω—ñ—Ñ–µ—Å—Ç: ${phpManifestUrl}`, 'success');
                        } else {
                            throw new Error('PHP –º–∞–Ω—ñ—Ñ–µ—Å—Ç –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∏–π –∞–±–æ –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–∏–π —Ç–∏–ø');
                        }
                    } catch (error) {
                        log(`‚ö†Ô∏è PHP –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∏–π, –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î–º–æ JavaScript –≤–µ—Ä—Å—ñ—é: ${error.message}`, 'info');
                        
                        // –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î–º–æ JavaScript –≥–µ–Ω–µ—Ä–∞—Ç–æ—Ä –º–∞–Ω—ñ—Ñ–µ—Å—Ç–∞
                        if (typeof window.createManifestBlobUrl === 'function') {
                            const blobUrl = window.createManifestBlobUrl(clientId);
                            manifestLink.href = blobUrl;
                            log(`‚úÖ –ú–∞–Ω—ñ—Ñ–µ—Å—Ç –æ–Ω–æ–≤–ª–µ–Ω–æ –∑ JavaScript –≥–µ–Ω–µ—Ä–∞—Ç–æ—Ä–∞: ${blobUrl}`, 'success');
                        } else {
                            log('‚ö†Ô∏è JavaScript –≥–µ–Ω–µ—Ä–∞—Ç–æ—Ä –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∏–π, –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î–º–æ —Å—Ç–∞—Ç–∏—á–Ω–∏–π –º–∞–Ω—ñ—Ñ–µ—Å—Ç', 'info');
                            manifestLink.href = 'manifest.json';
                        }
                    }
                }
            } else {
                log('üìÑ –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î–º–æ —Å—Ç–∞—Ç–∏—á–Ω–∏–π –º–∞–Ω—ñ—Ñ–µ—Å—Ç', 'info');
                const manifestLink = document.querySelector('link[rel="manifest"]');
                if (manifestLink) {
                    manifestLink.href = 'manifest.json';
                }
            }
        }

        // –ó–∞–ø—É—Å–∫–∞—î–º–æ —Ç–µ—Å—Ç–∏ –ø—Ä–∏ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—ñ
        document.addEventListener('DOMContentLoaded', () => {
            log('üì± –¢–µ—Å—Ç-—Å—Ç–æ—Ä—ñ–Ω–∫–∞ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–∞', 'info');
            
            // –ü–µ—Ä–µ–≤—ñ—Ä—è—î–º–æ —á–∏ —î Client ID –≤ URL, —è–∫—â–æ –Ω–µ–º–∞—î - –¥–æ–¥–∞—î–º–æ —Ç–µ—Å—Ç–æ–≤–∏–π
            const urlParams = new URLSearchParams(window.location.search);
            const clientId = urlParams.get('id');
            
            if (!clientId) {
                log('‚ö†Ô∏è Client ID –≤—ñ–¥—Å—É—Ç–Ω—ñ–π –≤ URL, –¥–æ–¥–∞—î–º–æ —Ç–µ—Å—Ç–æ–≤–∏–π...', 'info');
                const testClientId = '53f5172d-786f-4978-9607-4f699ecb7b7c';
                const newUrl = `${window.location.pathname}?id=${testClientId}`;
                window.location.href = newUrl;
                return; // –ó—É–ø–∏–Ω—è—î–º–æ –≤–∏–∫–æ–Ω–∞–Ω–Ω—è, –æ—Å–∫—ñ–ª—å–∫–∏ –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª—è—î–º–æ
            }
            
            // –í–∏–∫–æ–Ω—É—î–º–æ —Ñ—É–Ω–∫—Ü—ñ—é updateManifestLink –≤—ñ–¥—Ä–∞–∑—É –ø—Ä–∏ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—ñ
            log('üîÑ –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–µ –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –º–∞–Ω—ñ—Ñ–µ—Å—Ç–∞ –ø—Ä–∏ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—ñ...', 'info');
            simulateUpdateManifestLink();
            
            // –ó–∞—Ç—Ä–∏–º–∫–∞ –ø–µ—Ä–µ–¥ —Ç–µ—Å—Ç–∞–º–∏ –¥–ª—è –∑–∞–≤–µ—Ä—à–µ–Ω–Ω—è —ñ–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ—ó
            setTimeout(() => {
                runAllTests();
            }, 1000);
        });
    </script>
</body>
</html>
