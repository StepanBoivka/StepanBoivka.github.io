# üçé iOS PWA Client ID - –ó–≤—ñ—Ç –ø—Ä–æ –†–µ–∞–ª—ñ–∑–∞—Ü—ñ—é

## üìã –ü—Ä–æ–±–ª–µ–º–∞
–ù–∞ iOS Safari –ø—Ä–∏ –¥–æ–¥–∞–≤–∞–Ω–Ω—ñ PWA "–ù–∞ –ø–æ—á–∞—Ç–∫–æ–≤–∏–π –µ–∫—Ä–∞–Ω" –≤—Ç—Ä–∞—á–∞—é—Ç—å—Å—è URL –ø–∞—Ä–∞–º–µ—Ç—Ä–∏ (client ID), —ñ —è—Ä–ª–∏–∫ –∑–∞–≤–∂–¥–∏ –≤–µ–¥–µ –Ω–∞ –≥–æ–ª–æ–≤–Ω—É —Å—Ç–æ—Ä—ñ–Ω–∫—É –±–µ–∑ `?id=...`.

## üîß –†–µ–∞–ª—ñ–∑–æ–≤–∞–Ω—ñ –†—ñ—à–µ–Ω–Ω—è

### 1. **–†–∞–Ω—î PWA –ü–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–Ω—è** 
```javascript
function checkPWARedirect() {
    const isIOSPWA = isIOSSafari && window.navigator.standalone === true;
    
    if (isIOSPWA && storedId && !currentId) {
        window.location.href = newUrl.href; // –°–ø–µ—Ü—ñ–∞–ª—å–Ω–æ –¥–ª—è iOS
    }
}
```

### 2. **DOM Ready –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞**
```javascript
document.addEventListener('DOMContentLoaded', function() {
    setTimeout(function() {
        if (isIOSPWA && storedId && !currentId) {
            window.location.href = newUrl.href;
        }
    }, 100);
});
```

### 3. **Window Load –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞** 
```javascript
window.addEventListener('load', function() {
    setTimeout(function() {
        if (isIOSPWA && !currentId && storedId) {
            window.location.href = targetUrl;
        }
    }, 500);
});
```

### 4. **–°–ø–µ—Ü—ñ–∞–ª—å–Ω–∞ iOS –§—É–Ω–∫—Ü—ñ—è**
```javascript
function ensureIOSPWARedirect() {
    const isIOSPWA = isIOSSafari && window.navigator.standalone === true;
    
    if (isIOSPWA && storedId && !currentId) {
        localStorage.setItem('last_ios_redirect', Date.now().toString());
        window.location.href = targetUrl;
        return true;
    }
    return false;
}
```

## üöÄ –Ø–∫ –ü—Ä–∞—Ü—é—î

### –ö—Ä–æ–∫ 1: –ö–æ—Ä–∏—Å—Ç—É–≤–∞—á –≤—ñ–¥–≤—ñ–¥—É—î —Å–∞–π—Ç –∑ client ID
```
https://map-lab.live/?id=5359bf01-5d62-4706-96cd-e1ccadff2763
```

### –ö—Ä–æ–∫ 2: Client ID –∑–±–µ—Ä—ñ–≥–∞—î—Ç—å—Å—è –≤ localStorage
```javascript
localStorage.setItem('client_id', '5359bf01-5d62-4706-96cd-e1ccadff2763');
```

### –ö—Ä–æ–∫ 3: –ö–æ—Ä–∏—Å—Ç—É–≤–∞—á –¥–æ–¥–∞—î PWA "–ù–∞ –ø–æ—á–∞—Ç–∫–æ–≤–∏–π –µ–∫—Ä–∞–Ω"
- iOS Safari —Å—Ç–≤–æ—Ä—é—î —è—Ä–ª–∏–∫ –∑ –±–∞–∑–æ–≤–∏–º URL: `https://map-lab.live/`
- –ü–∞—Ä–∞–º–µ—Ç—Ä–∏ URL –≤—Ç—Ä–∞—á–∞—é—Ç—å—Å—è (–æ–±–º–µ–∂–µ–Ω–Ω—è iOS)

### –ö—Ä–æ–∫ 4: –ö–æ—Ä–∏—Å—Ç—É–≤–∞—á –∑–∞–ø—É—Å–∫–∞—î PWA –∑ —è—Ä–ª–∏–∫–∞
- PWA –∑–∞–ø—É—Å–∫–∞—î—Ç—å—Å—è –∑ `https://map-lab.live/` (–±–µ–∑ client ID)
- –ù–∞—à–∞ –ª–æ–≥—ñ–∫–∞ –≤–∏—è–≤–ª—è—î iOS PWA —Ä–µ–∂–∏–º
- –ó–Ω–∞—Ö–æ–¥–∏—Ç—å –∑–±–µ—Ä–µ–∂–µ–Ω–∏–π client ID –≤ localStorage
- **–ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª—è—î** –Ω–∞ `https://map-lab.live/?id=5359bf01-5d62-4706-96cd-e1ccadff2763`

## üîç –î–µ—Ç–µ–∫—Ü—ñ—è iOS PWA

```javascript
const isIOSSafari = /iPad|iPhone|iPod/.test(navigator.userAgent) && !window.MSStream;
const isIOSPWA = isIOSSafari && window.navigator.standalone === true;
```

**–ö–ª—é—á–æ–≤–∏–π –º–æ–º–µ–Ω—Ç:** `window.navigator.standalone === true` ‚Äî —Ü–µ —Å–ø–µ—Ü—ñ–∞–ª—å–Ω–∞ –≤–ª–∞—Å—Ç–∏–≤—ñ—Å—Ç—å iOS Safari, —è–∫–∞ `true` —Ç—ñ–ª—å–∫–∏ –≤ PWA —Ä–µ–∂–∏–º—ñ.

## üì± –¢–µ—Å—Ç—É–≤–∞–Ω–Ω—è

### –§–∞–π–ª: `ios_pwa_test.html`
- –°–ø–µ—Ü—ñ–∞–ª—å–Ω–∞ —Ç–µ—Å—Ç–æ–≤–∞ —Å—Ç–æ—Ä—ñ–Ω–∫–∞ –¥–ª—è –¥—ñ–∞–≥–Ω–æ—Å—Ç–∏–∫–∏ iOS PWA
- –ü–æ–∫–∞–∑—É—î –¥–µ—Ç–∞–ª—å–Ω—É —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—é –ø—Ä–æ —Ä–µ–∂–∏–º —Ä–æ–±–æ—Ç–∏
- –î–æ–∑–≤–æ–ª—è—î —Ç–µ—Å—Ç—É–≤–∞—Ç–∏ client ID –ª–æ–≥—ñ–∫—É

### –Ü–Ω—Å—Ç—Ä—É–∫—Ü—ñ—ó –¥–ª—è —Ç–µ—Å—Ç—É–≤–∞–Ω–Ω—è:
1. –í—ñ–¥–∫—Ä–∏–π—Ç–µ `https://map-lab.live/?id=test-id` –≤ Safari –Ω–∞ iPhone
2. –ù–∞—Ç–∏—Å–Ω—ñ—Ç—å "–ü–æ–¥—ñ–ª–∏—Ç–∏—Å—è" ‚Üí "–ù–∞ –ø–æ—á–∞—Ç–∫–æ–≤–∏–π –µ–∫—Ä–∞–Ω"
3. –ó–∞–ø—É—Å—Ç—ñ—Ç—å PWA –∑ –ø–æ—á–∞—Ç–∫–æ–≤–æ–≥–æ –µ–∫—Ä–∞–Ω—É
4. PWA –º–∞—î –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–∏—Ç–∏ –Ω–∞ URL –∑ client ID

## ‚ö° –ú–Ω–æ–∂–∏–Ω–Ω—ñ –†—ñ–≤–Ω—ñ –ó–∞—Ö–∏—Å—Ç—É

–ú–∏ —Ä–µ–∞–ª—ñ–∑—É–≤–∞–ª–∏ **4 —Ä—ñ–≤–Ω—ñ –ø–µ—Ä–µ–≤—ñ—Ä–∫–∏** –Ω–∞ —Ä—ñ–∑–Ω–∏—Ö –µ—Ç–∞–ø–∞—Ö –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è:

1. **–ù–µ–≥–∞–π–Ω–æ –ø—Ä–∏ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—ñ —Å–∫—Ä–∏–ø—Ç–∞** - `checkPWARedirect()`
2. **–ü—Ä–∏ DOMContentLoaded** - –∑ –∑–∞—Ç—Ä–∏–º–∫–æ—é 100ms
3. **–ü—Ä–∏ window.load** - –∑ –∑–∞—Ç—Ä–∏–º–∫–æ—é 500ms  
4. **–°–ø–µ—Ü—ñ–∞–ª—å–Ω–∞ iOS —Ñ—É–Ω–∫—Ü—ñ—è** - `ensureIOSPWARedirect()`

–¶–µ –≥–∞—Ä–∞–Ω—Ç—É—î, —â–æ –Ω–∞–≤—ñ—Ç—å —è–∫—â–æ –æ–¥–∏–Ω —Ä—ñ–≤–µ–Ω—å –Ω–µ —Å–ø—Ä–∞—Ü—é—î, —ñ–Ω—à—ñ –ø—ñ–¥—Ö–æ–ø–ª—è—Ç—å –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–Ω—è.

## üéØ –û—á—ñ–∫—É–≤–∞–Ω–∏–π –†–µ–∑—É–ª—å—Ç–∞—Ç

‚úÖ **–î–æ:** iOS PWA —è—Ä–ª–∏–∫ ‚Üí `https://map-lab.live/` (–≤—Ç—Ä–∞—Ç–∞ client ID)
‚úÖ **–ü—ñ—Å–ª—è:** iOS PWA —è—Ä–ª–∏–∫ ‚Üí `https://map-lab.live/` ‚Üí –∞–≤—Ç–æ–ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–Ω—è ‚Üí `https://map-lab.live/?id=...`

## üìù –ü—Ä–∏–º—ñ—Ç–∫–∏

- **–û–±–º–µ–∂–µ–Ω–Ω—è iOS:** Apple –Ω–∞–≤–º–∏—Å–Ω–æ –Ω–µ –¥–æ–∑–≤–æ–ª—è—î –∑–±–µ—Ä—ñ–≥–∞—Ç–∏ URL –ø–∞—Ä–∞–º–µ—Ç—Ä–∏ –≤ PWA —è—Ä–ª–∏–∫–∞—Ö
- **–ù–∞—à–µ —Ä—ñ—à–µ–Ω–Ω—è:** –û–±—Ö–æ–¥–∏–º–æ —Ü–µ —á–µ—Ä–µ–∑ localStorage + –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–µ –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–Ω—è
- **–°—É–º—ñ—Å–Ω—ñ—Å—Ç—å:** –ü—Ä–∞—Ü—é—î —Ç—ñ–ª—å–∫–∏ –Ω–∞ iOS Safari; —ñ–Ω—à—ñ –±—Ä–∞—É–∑–µ—Ä–∏ –º–∞—é—Ç—å –∫—Ä–∞—â—É PWA –ø—ñ–¥—Ç—Ä–∏–º–∫—É
- **–ü—Ä–æ–¥—É–∫—Ç–∏–≤–Ω—ñ—Å—Ç—å:** –ü–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–Ω—è –≤—ñ–¥–±—É–≤–∞—î—Ç—å—Å—è –∑–∞ < 1 —Å–µ–∫—É–Ω–¥—É

## üîß –§–∞–π–ª–∏ –∑ –ó–º—ñ–Ω–∞–º–∏

- ‚úÖ `index.html` - –¥–æ–¥–∞–Ω–æ iOS PWA –ª–æ–≥—ñ–∫—É
- ‚úÖ `ios_pwa_test.html` - —Å—Ç–≤–æ—Ä–µ–Ω–æ —Ç–µ—Å—Ç–æ–≤—É —Å—Ç–æ—Ä—ñ–Ω–∫—É
- ‚úÖ –í—Å—ñ –∑–º—ñ–Ω–∏ –∑–±–µ—Ä—ñ–≥–∞—é—Ç—å –∑–≤–æ—Ä–æ—Ç–Ω—É —Å—É–º—ñ—Å–Ω—ñ—Å—Ç—å

---
**–°—Ç–∞—Ç—É—Å:** ‚úÖ –ì–æ—Ç–æ–≤–æ –¥–æ —Ç–µ—Å—Ç—É–≤–∞–Ω–Ω—è –Ω–∞ iOS Safari PWA
