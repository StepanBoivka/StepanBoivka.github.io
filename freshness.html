<!doctype html>
<html lang="uk">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ê–∫—Ç—É–∞–ª—å–Ω—ñ—Å—Ç—å –¥–∞–Ω–∏—Ö</title>    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        .freshness-good { color: #28a745 !important; }
        .freshness-warning { color: #ffc107 !important; }
        .freshness-bad { color: #dc3545 !important; }
        
        .council-card {
            transition: all 0.3s ease;
            margin-bottom: 1rem;
        }
        .council-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }
        .stats-box {
            font-size: 0.9rem;
            padding: 0.5rem;
            border-radius: 4px;
            background-color: rgba(0,0,0,0.03);
        }
        .progress {
            height: 25px;
            font-size: 0.9rem;
            font-weight: bold;
        }
        .progress-bar {
            display: flex;
            align-items: center;
            justify-content: center;
            min-width: 2em;
        }
        .view-switcher {
            position: absolute;
            right: 1rem;
            top: 1rem;
        }
        .table-view .progress {
            width: 400px;
        }
        @media (max-width: 768px) {
            .table-view .progress {
                width: 200px;
            }
        }
        .daily-updates-chart {
            height: 150px;
            margin-top: 1rem;
        }
    </style>
</head>
<body>
    <nav class="navbar navbar-dark bg-dark">
        <div class="container">
            <a class="navbar-brand" href="#" onclick="goBack(); return false;">
                <i class="bi bi-arrow-left me-2"></i>–ü–æ–≤–µ—Ä–Ω—É—Ç–∏—Å—è –Ω–∞ –∫–∞—Ä—Ç—É
            </a>
            <div class="view-switcher">
                <div class="btn-group" role="group">
                    <button type="button" class="btn btn-outline-light" data-view="cards">
                        <i class="bi bi-grid"></i>
                    </button>
                    <button type="button" class="btn btn-outline-light active" data-view="table">
                        <i class="bi bi-table"></i>
                    </button>
                </div>
            </div>
        </div>
    </nav>    <div class="container py-4">        <div class="d-flex justify-content-between align-items-center mb-4">
            <h1 class="mb-0" id="pageTitle">
                –ú–æ—î –ø—ñ–¥–ø—Ä–∏—î–º—Å—Ç–≤–æ
                <small class="text-muted fs-5 ms-3" id="pageSubtitle">
                    –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è...
                </small>
            </h1>
            <div class="btn-group">
                <button type="button" class="btn btn-outline-primary" onclick="copyKoatuuList()" title="–ö–æ–ø—ñ—é–≤–∞—Ç–∏ —Å–ø–∏—Å–æ–∫ –ö–û–ê–¢–£–£ –≤ –±—É—Ñ–µ—Ä –æ–±–º—ñ–Ω—É">
                    <i class="bi bi-clipboard"></i> –ö–æ–ø—ñ—é–≤–∞—Ç–∏ –ö–û–ê–¢–£–£
                </button>
                <button type="button" class="btn btn-outline-secondary dropdown-toggle dropdown-toggle-split" data-bs-toggle="dropdown">
                    <span class="visually-hidden">–ë—ñ–ª—å—à–µ –æ–ø—Ü—ñ–π</span>
                </button>
                <ul class="dropdown-menu">
                    <li><a class="dropdown-item" href="#" onclick="showPerformanceStats()">
                        <i class="bi bi-speedometer2 me-2"></i>–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø—Ä–æ–¥—É–∫—Ç–∏–≤–Ω–æ—Å—Ç—ñ
                    </a></li>
                    <li><a class="dropdown-item" href="#" onclick="clearCache()">
                        <i class="bi bi-arrow-clockwise me-2"></i>–û—á–∏—Å—Ç–∏—Ç–∏ –∫–µ—à
                    </a></li>
                    <li><hr class="dropdown-divider"></li>
                    <li><a class="dropdown-item" href="#" onclick="reloadWithNoCache()">
                        <i class="bi bi-arrow-repeat me-2"></i>–ü–µ—Ä–µ–∑–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏ –±–µ–∑ –∫–µ—à—É
                    </a></li>
                </ul>
            </div>
        </div><!-- –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –¥–ª—è —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—ó –ø—Ä–æ –ø—ñ–¥–ø—Ä–∏—î–º—Å—Ç–≤–æ -->
        <div id="enterpriseInfo" class="card border-primary mb-4" style="display: none;">
            <div class="card-header bg-primary text-white">
                <h4 class="mb-0"><i class="bi bi-building-fill me-2"></i>–Ü–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—è –ø—Ä–æ –ø—ñ–¥–ø—Ä–∏—î–º—Å—Ç–≤–æ</h4>
            </div>
            <div class="card-body">
                <!-- –ö–æ–Ω—Ç–µ–Ω—Ç –±—É–¥–µ –¥–æ–¥–∞–Ω–æ –¥–∏–Ω–∞–º—ñ—á–Ω–æ -->
            </div>
        </div>
        
        <!-- –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –¥–ª—è –∫–∞—Ä—Ç–æ–∫ -->
        <div id="cardsView" class="row" style="display: none">
            <!-- –ö–∞—Ä—Ç–∫–∏ –±—É–¥—É—Ç—å —Ç—É—Ç -->
        </div>

        <!-- –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –¥–ª—è —Ç–∞–±–ª–∏—Ü—ñ -->
        <div id="tableView" class="table-view">            <table class="table">                <thead>
                    <tr>
                        <th>–†–∞–¥–∞</th>
                        <th>–ö–û–ê–¢–£–£</th>                        <th>–°—Ç–∞—Ç—É—Å</th>
                        <th>–î—ñ–ª—è–Ω–æ–∫</th>
                        <th>–ê–∫—Ç—É–∞–ª—å–Ω—ñ—Å—Ç—å –¥–∞–Ω–∏—Ö</th>
                        <th>–û—Å—Ç–∞–Ω–Ω—î –æ–Ω–æ–≤–ª–µ–Ω–Ω—è</th>                        <th class="badge-column">–†–æ–∑–±—ñ–∂–Ω–æ—Å—Ç—ñ –≤ –î–ó–ö</th>
                        <th class="badge-column">–í—ñ–¥—Å—É—Ç–Ω—ñ –≤ –†–†–ü</th>
                    </tr>
                </thead>
                <tbody id="tableBody">
                    <!-- –†—è–¥–∫–∏ —Ç–∞–±–ª–∏—Ü—ñ –±—É–¥—É—Ç—å —Ç—É—Ç -->
                </tbody>
            </table>
        </div>
    </div>    <script>        
        // –ì–ª–æ–±–∞–ª—å–Ω—ñ –∑–º—ñ–Ω–Ω—ñ –¥–ª—è –∑–±–µ—Ä—ñ–≥–∞–Ω–Ω—è –¥–∞–Ω–∏—Ö –ø—Ä–æ —Ä–æ–∑–±—ñ–∂–Ω–æ—Å—Ç—ñ –ø–æ —Ä–∞–¥–∞—Ö
        let councilMissingInDzk = new Map(); // –í—ñ–¥—Å—É—Ç–Ω—ñ –≤ –î–ó–ö (—î –≤ –†–†–ü, –Ω–µ–º–∞—î –≤ –î–ó–ö)
        let councilMissingInRrp = new Map(); // –í—ñ–¥—Å—É—Ç–Ω—ñ –≤ –†–†–ü (—î –≤ –î–ó–ö, –Ω–µ–º–∞—î –≤ –†–†–ü)
        
        // –ì–ª–æ–±–∞–ª—å–Ω—ñ –∑–º—ñ–Ω–Ω—ñ –¥–ª—è client ID —Ç–∞ dataPath
        let globalId = null;
        let globalDataPath = null;

        // üöÄ –°–ò–°–¢–ï–ú–ê –ö–ï–®–£–í–ê–ù–ù–Ø –î–õ–Ø –ü–†–û–î–£–ö–¢–ò–í–ù–û–°–¢–Ü
        class DataCache {
            constructor() {
                this.cache = new Map();
                this.fetchPromises = new Map(); // –ó–∞–ø–æ–±—ñ–≥–∞—î–º–æ –¥—É–±–ª—é–≤–∞–Ω–Ω—é –∑–∞–ø–∏—Ç—ñ–≤
                this.stats = { hits: 0, misses: 0, errors: 0 };
            }
            
            async get(key, fetcher) {
                // –Ø–∫—â–æ –¥–∞–Ω—ñ –≤–∂–µ –≤ –∫–µ—à—ñ
                if (this.cache.has(key)) {
                    this.stats.hits++;
                    console.log(`üéØ Cache HIT for: ${key}`);
                    return this.cache.get(key);
                }
                
                // –Ø–∫—â–æ –≤–∂–µ —î –∞–∫—Ç–∏–≤–Ω–∏–π –∑–∞–ø–∏—Ç –¥–ª—è —Ü—å–æ–≥–æ –∫–ª—é—á–∞
                if (this.fetchPromises.has(key)) {
                    console.log(`‚è≥ Waiting for existing request: ${key}`);
                    return await this.fetchPromises.get(key);
                }
                
                // –°—Ç–≤–æ—Ä—é—î–º–æ –Ω–æ–≤–∏–π –∑–∞–ø–∏—Ç
                this.stats.misses++;
                console.log(`üì• Cache MISS for: ${key}`);
                
                const fetchPromise = this._fetchWithRetry(key, fetcher);
                this.fetchPromises.set(key, fetchPromise);
                
                try {
                    const data = await fetchPromise;
                    this.cache.set(key, data);
                    return data;
                } catch (error) {
                    this.stats.errors++;
                    throw error;
                } finally {
                    this.fetchPromises.delete(key);
                }
            }
            
            async _fetchWithRetry(key, fetcher, maxRetries = 2) {
                let lastError;
                for (let attempt = 0; attempt <= maxRetries; attempt++) {
                    try {
                        if (attempt > 0) {
                            console.log(`üîÑ Retry ${attempt}/${maxRetries} for: ${key}`);
                            await new Promise(resolve => setTimeout(resolve, 1000 * attempt));
                        }
                        return await fetcher();
                    } catch (error) {
                        lastError = error;
                        console.warn(`‚ùå Attempt ${attempt + 1} failed for ${key}:`, error.message);
                    }
                }
                throw lastError;
            }
            
            clear() {
                this.cache.clear();
                this.fetchPromises.clear();
                this.stats = { hits: 0, misses: 0, errors: 0 };
            }
            
            getStats() {
                const total = this.stats.hits + this.stats.misses;
                return {
                    ...this.stats,
                    hitRate: total > 0 ? ((this.stats.hits / total) * 100).toFixed(1) : 0,
                    cacheSize: this.cache.size
                };
            }
        }
        
        // –ì–ª–æ–±–∞–ª—å–Ω–∏–π –∫–µ—à
        const dataCache = new DataCache();
        
        // üöÄ –°–ò–°–¢–ï–ú–ê –ú–û–ù–Ü–¢–û–†–ò–ù–ì–£ –ü–†–û–î–£–ö–¢–ò–í–ù–û–°–¢–Ü
        class PerformanceMonitor {
            constructor() {
                this.timers = new Map();
                this.metrics = new Map();
                this.enabled = true;
            }
            
            start(label) {
                if (!this.enabled) return;
                this.timers.set(label, performance.now());
                console.time(label);
            }
            
            end(label, logResult = true) {
                if (!this.enabled) return;
                
                const startTime = this.timers.get(label);
                if (!startTime) return;
                
                const duration = performance.now() - startTime;
                this.timers.delete(label);
                
                if (!this.metrics.has(label)) {
                    this.metrics.set(label, []);
                }
                this.metrics.get(label).push(duration);
                
                console.timeEnd(label);
                if (logResult) {
                    console.log(`‚ö° ${label}: ${duration.toFixed(2)}ms`);
                }
                
                return duration;
            }
            
            getStats() {
                const stats = {};
                this.metrics.forEach((durations, label) => {
                    const avg = durations.reduce((a, b) => a + b, 0) / durations.length;
                    const min = Math.min(...durations);
                    const max = Math.max(...durations);
                    
                    stats[label] = {
                        calls: durations.length,
                        avg: avg.toFixed(2),
                        min: min.toFixed(2),
                        max: max.toFixed(2),
                        total: durations.reduce((a, b) => a + b, 0).toFixed(2)
                    };
                });
                return stats;
            }
            
            logSummary() {
                console.group('üìä –ó–≤—ñ—Ç –ø–æ –ø—Ä–æ–¥—É–∫—Ç–∏–≤–Ω–æ—Å—Ç—ñ');
                const stats = this.getStats();
                Object.entries(stats).forEach(([label, data]) => {
                    console.log(`${label}: avg=${data.avg}ms, calls=${data.calls}, total=${data.total}ms`);
                });
                console.log('üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∫–µ—à—É:', dataCache.getStats());
                console.groupEnd();
            }
        }
        
        const perfMonitor = new PerformanceMonitor();
        
        // üöÄ –ü–ê–†–ê–õ–ï–õ–¨–ù–ï –ó–ê–í–ê–ù–¢–ê–ñ–ï–ù–ù–Ø GEOJSON –§–ê–ô–õ–Ü–í
        async function loadGeojsonFiles(dataPath, fileList, batchSize = 5) {
            console.time('loadGeojsonFiles');
            console.log(`üìä –ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è ${fileList.length} —Ñ–∞–π–ª—ñ–≤ –±–∞—Ç—á–∞–º–∏ –ø–æ ${batchSize}`);
            
            const results = [];
            
            // –û–±—Ä–æ–±–ª—è—î–º–æ —Ñ–∞–π–ª–∏ –±–∞—Ç—á–∞–º–∏ –¥–ª—è –∫–æ–Ω—Ç—Ä–æ–ª—é –Ω–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è
            for (let i = 0; i < fileList.length; i += batchSize) {
                const batch = fileList.slice(i, i + batchSize);
                console.log(`üì¶ –ë–∞—Ç—á ${Math.floor(i/batchSize) + 1}/${Math.ceil(fileList.length/batchSize)}: ${batch.length} —Ñ–∞–π–ª—ñ–≤`);
                
                const batchPromises = batch.map(async (fileName) => {
                    const filePath = dataPath + fileName;
                    
                    return await dataCache.get(filePath, async () => {
                        const response = await fetch(filePath);
                        if (!response.ok) {
                            throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                        }
                        const data = await response.json();
                        
                        // –û–ø—Ç–∏–º—ñ–∑—É—î–º–æ –¥–∞–Ω—ñ –æ–¥—Ä–∞–∑—É –ø—Ä–∏ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—ñ
                        return {
                            fileName,
                            councilName: fileName.replace('.geojson', ''),
                            features: data.features || [],
                            totalFeatures: data.features?.length || 0,
                            loadedAt: Date.now()
                        };
                    });
                });
                
                try {
                    const batchResults = await Promise.all(batchPromises);
                    results.push(...batchResults);
                    
                    // –ù–µ–≤–µ–ª–∏–∫–∞ –ø–∞—É–∑–∞ –º—ñ–∂ –±–∞—Ç—á–∞–º–∏ –¥–ª—è –∑–º–µ–Ω—à–µ–Ω–Ω—è –Ω–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è
                    if (i + batchSize < fileList.length) {
                        await new Promise(resolve => setTimeout(resolve, 50));
                    }
                } catch (error) {
                    console.error(`‚ùå –ü–æ–º–∏–ª–∫–∞ –≤ –±–∞—Ç—á—ñ ${Math.floor(i/batchSize) + 1}:`, error);
                }
            }
            
            console.timeEnd('loadGeojsonFiles');
            console.log(`‚úÖ –ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–æ ${results.length}/${fileList.length} —Ñ–∞–π–ª—ñ–≤`);
            console.log('üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∫–µ—à—É:', dataCache.getStats());
            
            return results;
        }
        
        // üöÄ –û–ü–¢–ò–ú–Ü–ó–û–í–ê–ù–ê –û–ë–†–û–ë–ö–ê –î–ê–ù–ò–• –†–ê–î–ò
        function processCouncilData(councilData, edrpou, txtCadastralNumbers) {
            const { councilName, features } = councilData;
            
            // –§—ñ–ª—å—Ç—Ä—É—î–º–æ —Ç—ñ–ª—å–∫–∏ original –∑–∞–ø–∏—Å–∏ –æ–¥—Ä–∞–∑—É
            const originalFeatures = features.filter(feature => feature.properties?.type === 'original');
            
            const councilResult = {
                name: councilName,
                cadastralNumbers: new Set(),
                missingInDzkCount: 0,
                missingInRrpCount: 0,
                plotsDetails: new Map(),
                allPlots: new Map(),
                totalOriginalFeatures: originalFeatures.length
            };
            
            // –ó–±–∏—Ä–∞—î–º–æ –∫–∞–¥–∞—Å—Ç—Ä–æ–≤—ñ –Ω–æ–º–µ—Ä–∏ —Ü—ñ—î—ó —Ä–∞–¥–∏ –¥–ª—è –Ω–∞—à–æ–≥–æ –Ñ–î–†–ü–û–£
            originalFeatures.forEach(feature => {
                const props = feature.properties;
                const cadastralNumber = props?.['–ö–∞–¥–∞—Å—Ç—Ä–æ–≤–∏–π –Ω–æ–º–µ—Ä'];
                
                if (cadastralNumber) {
                    // –ó–±–µ—Ä—ñ–≥–∞—î–º–æ —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—é –ø—Ä–æ –≤—Å—ñ –¥—ñ–ª—è–Ω–∫–∏ —Ä–∞–¥–∏
                    if (!councilResult.allPlots.has(cadastralNumber)) {
                        councilResult.allPlots.set(cadastralNumber, {
                            cadastral: cadastralNumber,
                            owner: props['–í–ª–∞—Å–Ω–∏–∫'] || '',
                            tenant: props['–û—Ä–µ–Ω–¥–∞—Ä'] || props['–û—Ä–µ–Ω–¥–∞—Ä —á–∞—Å—Ç–∏–Ω–∏'] || '',
                            tenantEdrpou: props['–Ñ–î–†–ü–û–£ –æ—Ä–µ–Ω–¥–∞—Ä—è –¥—ñ–ª—è–Ω–∫–∏'] || '',
                            area: props['–ü–ª–æ—â–∞ —Ä–æ–∑—Ä–∞—Ö–æ–≤–∞–Ω–∞'] || props['–ü–ª–æ—â–∞ —á–∞—Å—Ç–∏–Ω–∏'] || '',
                            registrationDate: props['–î–∞—Ç–∞ —Ä–µ—î—Å—Ç—Ä–∞—Ü—ñ—ó –æ—Ä–µ–Ω–¥–∏'] || '',
                            expiryDate: props['–î–∞—Ç–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–Ω—è'] || '',
                            status: props['–°—Ç–∞—Ç—É—Å'] || '',
                            field: props['–ù–∞–∑–≤–∞ –ø–æ–ª—è'] || '',
                            council: councilName
                        });
                    }
                    
                    // –Ø–∫—â–æ –¥—ñ–ª—è–Ω–∫–∞ –∑ –Ω–∞—à–∏–º –Ñ–î–†–ü–û–£
                    if (props['–Ñ–î–†–ü–û–£ –æ—Ä–µ–Ω–¥–∞—Ä—è –¥—ñ–ª—è–Ω–∫–∏'] === edrpou) {
                        councilResult.cadastralNumbers.add(cadastralNumber);
                        // –ó–±–µ—Ä—ñ–≥–∞—î–º–æ –¥–µ—Ç–∞–ª—å–Ω—É —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—é –ø—Ä–æ –¥—ñ–ª—è–Ω–∫—É –∑ –Ω–∞—à–∏–º –Ñ–î–†–ü–û–£
                        if (!councilResult.plotsDetails.has(cadastralNumber)) {
                            councilResult.plotsDetails.set(cadastralNumber, {
                                cadastral: cadastralNumber,
                                owner: props['–í–ª–∞—Å–Ω–∏–∫'] || '',
                                tenant: props['–û—Ä–µ–Ω–¥–∞—Ä'] || props['–û—Ä–µ–Ω–¥–∞—Ä —á–∞—Å—Ç–∏–Ω–∏'] || '',
                                area: props['–ü–ª–æ—â–∞ —Ä–æ–∑—Ä–∞—Ö–æ–≤–∞–Ω–∞'] || props['–ü–ª–æ—â–∞ —á–∞—Å—Ç–∏–Ω–∏'] || '',
                                registrationDate: props['–î–∞—Ç–∞ —Ä–µ—î—Å—Ç—Ä–∞—Ü—ñ—ó –æ—Ä–µ–Ω–¥–∏'] || '',
                                expiryDate: props['–î–∞—Ç–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–Ω—è'] || '',
                                status: props['–°—Ç–∞—Ç—É—Å'] || '',
                                field: props['–ù–∞–∑–≤–∞ –ø–æ–ª—è'] || '',
                                council: councilName
                            });
                        }
                    }
                }
            });
            
            return councilResult;
        }
        
        // –§—É–Ω–∫—Ü—ñ—è –¥–ª—è –æ—Ç—Ä–∏–º–∞–Ω–Ω—è client ID –∑ URL –∞–±–æ localStorage
        function getClientId() {
            const urlParams = new URLSearchParams(window.location.search);
            let id = urlParams.get('id');
            
            // –Ø–∫—â–æ id –Ω–µ–º–∞—î –≤ URL, —Å–ø—Ä–æ–±—É—î–º–æ –æ—Ç—Ä–∏–º–∞—Ç–∏ –∑ localStorage
            if (!id) {
                const storedId = localStorage.getItem('client_id');
                if (storedId) {
                    id = storedId;
                    console.log('Client ID –≤—ñ–¥–Ω–æ–≤–ª–µ–Ω–æ –∑ localStorage –≤ freshness.html:', id);
                    
                    // –û–Ω–æ–≤–ª—é—î–º–æ URL –±–µ–∑ –ø–µ—Ä–µ–∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è —Å—Ç–æ—Ä—ñ–Ω–∫–∏
                    const currentUrl = new URL(window.location);
                    currentUrl.searchParams.set('id', id);
                    window.history.replaceState({}, '', currentUrl);
                }
            }
            
            return id;
        }
        
        document.addEventListener('DOMContentLoaded', function() {
            globalId = getClientId();
            globalDataPath = globalId ? `data/${globalId}/` : 'data/';

            // –°–ø–æ—á–∞—Ç–∫—É —à—É–∫–∞—î–º–æ txt —Ñ–∞–π–ª–∏ –¥–ª—è –ø—ñ–¥–ø—Ä–∏—î–º—Å—Ç–≤–∞
            loadEnterpriseData(globalDataPath, globalId);
            
            // –ü–æ—Ç—ñ–º –∑–∞–≤–∞–Ω—Ç–∞–∂—É—î–º–æ –¥–∞–Ω—ñ —Ä–∞–¥
            loadAndAnalyzeData(globalDataPath, !!globalId);
        });async function loadEnterpriseData(dataPath, enterpriseId) {
            if (!enterpriseId) {
                // –Ø–∫—â–æ –Ω–µ–º–∞—î ID –ø—ñ–¥–ø—Ä–∏—î–º—Å—Ç–≤–∞, —Ö–æ–≤–∞—î–º–æ –±–ª–æ–∫
                return;
            }

            try {
                // –®—É–∫–∞—î–º–æ txt —Ñ–∞–π–ª–∏ –∑ GUID –ø—ñ–¥–ø—Ä–∏—î–º—Å—Ç–≤–∞
                const txtFiles = await findTxtFiles(dataPath, enterpriseId);
                
                if (txtFiles.length > 0) {
                    document.getElementById('enterpriseInfo').style.display = 'block';
                      // –ó–∞–≤–∞–Ω—Ç–∞–∂—É—î–º–æ —Ç–∞ –ø–∞—Ä—Å–∏–º–æ –≤–º—ñ—Å—Ç —Ñ–∞–π–ª—ñ–≤
                    let allEnterpriseData = [];                    for (const fileName of txtFiles) {                        try {
                            // Txt —Ñ–∞–π–ª–∏ –∑–∞–≤–∂–¥–∏ –∑–Ω–∞—Ö–æ–¥—è—Ç—å—Å—è –≤ –∫–æ—Ä–µ–Ω—ñ data/, –Ω–µ–∑–∞–ª–µ–∂–Ω–æ –≤—ñ–¥ dataPath
                            const filePath = 'data/' + fileName;
                            const response = await fetch(filePath);
                            const content = await response.text();
                            const parsedData = parseEnterpriseFile(content, fileName);
                            allEnterpriseData.push(parsedData);
                        } catch (error) {
                            console.error(`–ü–æ–º–∏–ª–∫–∞ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è —Ñ–∞–π–ª—É ${fileName}:`, error);
                        }
                    }
                    
                    // –í—ñ–¥–æ–±—Ä–∞–∂–∞—î–º–æ —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—é –ø—Ä–æ –ø—ñ–¥–ø—Ä–∏—î–º—Å—Ç–≤–∞
                    displayEnterpriseInfo(allEnterpriseData);
                }
            } catch (error) {
                console.error('–ü–æ–º–∏–ª–∫–∞ –ø–æ—à—É–∫—É txt —Ñ–∞–π–ª—ñ–≤:', error);
            }
        }        async function findTxtFiles(dataPath, enterpriseId) {
            const txtFiles = [];
            console.log(`–ü–æ—à—É–∫ txt —Ñ–∞–π–ª—ñ–≤ –¥–ª—è enterpriseId: "${enterpriseId}"`);

            try {
                // –°–ø–æ—á–∞—Ç–∫—É –ø–µ—Ä–µ–≤—ñ—Ä—è—î–º–æ —á–∏ —ñ—Å–Ω—É—î —Ñ–∞–π–ª –∑ —Ç–æ—á–Ω–æ—é –Ω–∞–∑–≤–æ—é enterpriseId.txt
                try {
                    const directResponse = await fetch(`data/${enterpriseId}.txt`);
                    if (directResponse.ok) {
                        console.log(`–ó–Ω–∞–π–¥–µ–Ω–æ –ø—Ä—è–º–∏–π —Ñ–∞–π–ª: ${enterpriseId}.txt`);
                        txtFiles.push(`${enterpriseId}.txt`);
                        return txtFiles;
                    }
                } catch (error) {
                    // –§–∞–π–ª –Ω–µ —ñ—Å–Ω—É—î, –ø—Ä–æ–¥–æ–≤–∂—É—î–º–æ –ø–æ—à—É–∫
                }

                // –°–ø—Ä–æ–±—É—î–º–æ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞—Ç–∏ —Å—Ç–∞—Ç–∏—á–Ω–∏–π —Å–ø–∏—Å–æ–∫ —Ñ–∞–π–ª—ñ–≤
                try {
                    const response = await fetch('data/txt_list.json');
                    if (response.ok) {
                        const data = await response.json();
                        const allFiles = data.files || [];                        console.log(`–û—Ç—Ä–∏–º–∞–Ω–æ ${allFiles.length} txt —Ñ–∞–π–ª—ñ–≤ –∑—ñ —Å—Ç–∞—Ç–∏—á–Ω–æ–≥–æ —Å–ø–∏—Å–∫—É`);

                        // –®—É–∫–∞—î–º–æ —Ñ–∞–π–ª–∏ —è–∫—ñ –º—ñ—Å—Ç—è—Ç—å enterpriseId –≤ –Ω–∞–∑–≤—ñ
                        const matchingFiles = allFiles.filter(fileName => {
                            console.log(`–ü–µ—Ä–µ–≤—ñ—Ä—è—î–º–æ —Ñ–∞–π–ª: ${fileName} –¥–ª—è enterpriseId: ${enterpriseId}`);
                            
                            // –ü–µ—Ä–µ–≤—ñ—Ä—è—î–º–æ —á–∏ –º—ñ—Å—Ç–∏—Ç—å —Ñ–∞–π–ª enterpriseId —è–∫ –ø—ñ–¥—Ä—è–¥–æ–∫
                            if (fileName.includes(enterpriseId)) {
                                console.log(`‚úì –ó–Ω–∞–π–¥–µ–Ω–æ —Å–ø—ñ–≤–ø–∞–¥—ñ–Ω–Ω—è (–ø—Ä—è–º–∏–π –ø–æ—à—É–∫): ${fileName}`);
                                return true;
                            }
                            
                            // –Ø–∫—â–æ enterpriseId –≤–∏–≥–ª—è–¥–∞—î —è–∫ GUID, –ø–µ—Ä–µ–≤—ñ—Ä—è—î–º–æ –π–æ–≥–æ —á–∞—Å—Ç–∏–Ω–∏
                            if (enterpriseId.includes('-') && enterpriseId.length >= 32) {
                                const guidParts = enterpriseId.split('-');
                                console.log(`–ü–µ—Ä–µ–≤—ñ—Ä—è—î–º–æ —á–∞—Å—Ç–∏–Ω–∏ GUID: ${guidParts.join(', ')}`);
                                const allPartsMatch = guidParts.every(part => {
                                    const matches = fileName.includes(part);
                                    console.log(`  –ß–∞—Å—Ç–∏–Ω–∞ "${part}" –≤ —Ñ–∞–π–ª—ñ "${fileName}": ${matches}`);
                                    return matches;
                                });
                                if (allPartsMatch) {
                                    console.log(`‚úì –ó–Ω–∞–π–¥–µ–Ω–æ —Å–ø—ñ–≤–ø–∞–¥—ñ–Ω–Ω—è (–ø–æ—à—É–∫ –∑–∞ —á–∞—Å—Ç–∏–Ω–∞–º–∏): ${fileName}`);
                                    return true;
                                }
                            }
                            
                            return false;
                        });

                        if (matchingFiles.length > 0) {
                            console.log(`–ó–Ω–∞–π–¥–µ–Ω–æ —Ñ–∞–π–ª–∏ —á–µ—Ä–µ–∑ –ø–æ—à—É–∫ –≤ —Å—Ç–∞—Ç–∏—á–Ω–æ–º—É —Å–ø–∏—Å–∫—É:`, matchingFiles);
                            txtFiles.push(...matchingFiles);
                            return txtFiles;
                        }
                    }
                } catch (error) {
                    console.error('–°—Ç–∞—Ç–∏—á–Ω–∏–π —Å–ø–∏—Å–æ–∫ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∏–π:', error);
                }

                // –Ø–∫—â–æ –Ω—ñ—á–æ–≥–æ –Ω–µ –∑–Ω–∞–π—à–ª–∏, —Å–ø—Ä–æ–±—É—î–º–æ –¥–∏–Ω–∞–º—ñ—á–Ω–∏–π –ø–æ—à—É–∫ —á–µ—Ä–µ–∑ PHP (—è–∫—â–æ –¥–æ—Å—Ç—É–ø–Ω–∏–π)
                try {
                    const response = await fetch('list_txt_files.php');
                    if (response.ok) {
                        const data = await response.json();
                        const allFiles = data.files || [];
                        console.log(`–û—Ç—Ä–∏–º–∞–Ω–æ ${allFiles.length} txt —Ñ–∞–π–ª—ñ–≤ —á–µ—Ä–µ–∑ PHP —Å–∫—Ä–∏–ø—Ç`);

                        // –®—É–∫–∞—î–º–æ —Ñ–∞–π–ª–∏ —è–∫—ñ –º—ñ—Å—Ç—è—Ç—å enterpriseId –≤ –Ω–∞–∑–≤—ñ
                        const matchingFiles = allFiles.filter(fileName => {
                            // –ü–µ—Ä–µ–≤—ñ—Ä—è—î–º–æ —á–∏ –º—ñ—Å—Ç–∏—Ç—å —Ñ–∞–π–ª enterpriseId —è–∫ –ø—ñ–¥—Ä—è–¥–æ–∫
                            if (fileName.includes(enterpriseId)) {
                                return true;
                            }
                            
                            // –Ø–∫—â–æ enterpriseId –≤–∏–≥–ª—è–¥–∞—î —è–∫ GUID, –ø–µ—Ä–µ–≤—ñ—Ä—è—î–º–æ –π–æ–≥–æ —á–∞—Å—Ç–∏–Ω–∏
                            if (enterpriseId.includes('-') && enterpriseId.length >= 32) {
                                const guidParts = enterpriseId.split('-');
                                return guidParts.every(part => fileName.includes(part));
                            }
                            
                            return false;
                        });

                        if (matchingFiles.length > 0) {
                            console.log(`–ó–Ω–∞–π–¥–µ–Ω–æ —Ñ–∞–π–ª–∏ —á–µ—Ä–µ–∑ –ø–æ—à—É–∫ –≤ –¥–∏–Ω–∞–º—ñ—á–Ω–æ–º—É —Å–ø–∏—Å–∫—É:`, matchingFiles);
                            txtFiles.push(...matchingFiles);
                        }
                    }
                } catch (error) {
                    console.error('PHP —Å–∫—Ä–∏–ø—Ç –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∏–π:', error);
                }
            } catch (error) {
                console.error('–ü–æ–º–∏–ª–∫–∞ –ø–æ—à—É–∫—É txt —Ñ–∞–π–ª—ñ–≤:', error);
            }
            
            console.log(`–†–µ–∑—É–ª—å—Ç–∞—Ç –ø–æ—à—É–∫—É txt —Ñ–∞–π–ª—ñ–≤:`, txtFiles);
            return txtFiles;
        }

        function parseEnterpriseFile(content, fileName) {
            const lines = content.trim().split('\n');
            const data = {
                fileName: fileName,
                edrpou: '',
                enterpriseName: '',
                actualityDate: '',
                cadastralNumbers: []
            };

            for (const line of lines) {
                const trimmedLine = line.trim();
                
                if (trimmedLine.startsWith('–Ñ–î–†–ü–û–£:')) {
                    data.edrpou = trimmedLine.replace('–Ñ–î–†–ü–û–£:', '').trim();
                } else if (trimmedLine.startsWith('–ù–∞–∑–≤–∞ –ø—ñ–¥–ø—Ä–∏—î–º—Å—Ç–≤–∞:')) {
                    data.enterpriseName = trimmedLine.replace('–ù–∞–∑–≤–∞ –ø—ñ–¥–ø—Ä–∏—î–º—Å—Ç–≤–∞:', '').trim();
                } else if (trimmedLine.startsWith('–î–∞—Ç–∞ –∞–∫—Ç—É–∞–ª—å–Ω–æ—Å—Ç—ñ:')) {
                    data.actualityDate = trimmedLine.replace('–î–∞—Ç–∞ –∞–∫—Ç—É–∞–ª—å–Ω–æ—Å—Ç—ñ:', '').trim();
                } else if (trimmedLine.includes(':')) {
                    // –¶–µ –∫–∞–¥–∞—Å—Ç—Ä–æ–≤–∏–π –Ω–æ–º–µ—Ä
                    data.cadastralNumbers.push(trimmedLine);
                }
            }

            return data;
        }        async function displayEnterpriseInfo(enterpriseDataArray) {
            const infoContainer = document.getElementById('enterpriseInfo');
            
            if (enterpriseDataArray.length === 0) {
                infoContainer.querySelector('.card-body').innerHTML = `
                    <div class="text-center text-muted">
                        <i class="bi bi-exclamation-triangle fs-1"></i>
                        <p class="mt-2">–î–∞–Ω—ñ –ø—Ä–æ –ø—ñ–¥–ø—Ä–∏—î–º—Å—Ç–≤–æ –Ω–µ –∑–Ω–∞–π–¥–µ–Ω–æ</p>
                    </div>
                `;
                return;
            }

            // –ü—ñ–¥—Ä–∞—Ö—É–Ω–æ–∫ –∑–∞–≥–∞–ª—å–Ω–æ—ó –∫—ñ–ª—å–∫–æ—Å—Ç—ñ –∫–∞–¥–∞—Å—Ç—Ä–æ–≤–∏—Ö –Ω–æ–º–µ—Ä—ñ–≤ –∑ —É—Å—ñ—Ö –ø—ñ–¥–ø—Ä–∏—î–º—Å—Ç–≤
            const totalCadastralNumbers = enterpriseDataArray.reduce((sum, item) => sum + item.cadastralNumbers.length, 0);

            // –ó–±–∏—Ä–∞—î–º–æ –≤—Å—ñ –∫–∞–¥–∞—Å—Ç—Ä–æ–≤—ñ –Ω–æ–º–µ—Ä–∏ –∑ txt —Ñ–∞–π–ª—ñ–≤
            const txtCadastralNumbers = new Set();
            enterpriseDataArray.forEach(item => {
                item.cadastralNumbers.forEach(number => {
                    txtCadastralNumbers.add(number);
                });
            });

            // –°—Ç–≤–æ—Ä—é—î–º–æ –∑–∞–≥–æ–ª–æ–≤–æ–∫ –∑ —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—î—é –ø—Ä–æ –∫—ñ–ª—å–∫—ñ—Å—Ç—å –ø—ñ–¥–ø—Ä–∏—î–º—Å—Ç–≤
            const enterpriseNames = enterpriseDataArray.map(item => item.enterpriseName).join(', ');
            const edrpouNumbers = enterpriseDataArray.map(item => item.edrpou).join(', ');
            const title = enterpriseDataArray.length > 1 
                ? `${enterpriseDataArray.length} –ø—ñ–¥–ø—Ä–∏—î–º—Å—Ç–≤–∞ –∑ –æ–¥–Ω–∞–∫–æ–≤–∏–º –≤–ª–∞—Å–Ω–∏–∫–æ–º`
                : enterpriseDataArray[0].enterpriseName;            // –ü–æ—Ä—ñ–≤–Ω—é—î–º–æ –∑ geojson —Ñ–∞–π–ª–∞–º–∏ –¥–ª—è –∫–æ–∂–Ω–æ–≥–æ –ø—ñ–¥–ø—Ä–∏—î–º—Å—Ç–≤–∞ –æ–∫—Ä–µ–º–æ
            let combinedComparison;
            let enterpriseComparisons = [];
            
            if (enterpriseDataArray.length === 1) {
                // –û–¥–Ω–µ –ø—ñ–¥–ø—Ä–∏—î–º—Å—Ç–≤–æ - —Ä–æ–±–∏–º–æ –∑–≤–∏—á–∞–π–Ω–µ –ø–æ—Ä—ñ–≤–Ω—è–Ω–Ω—è
                combinedComparison = await compareWithGeojson(enterpriseDataArray[0].edrpou, txtCadastralNumbers);
            } else {
                // –ö—ñ–ª—å–∫–∞ –ø—ñ–¥–ø—Ä–∏—î–º—Å—Ç–≤ - –ø–æ—Ä—ñ–≤–Ω—é—î–º–æ –∫–æ–∂–Ω–µ –æ–∫—Ä–µ–º–æ
                for (const enterprise of enterpriseDataArray) {
                    const enterpriseCadastralNumbers = new Set(enterprise.cadastralNumbers);
                    const enterpriseComparison = await compareWithGeojson(enterprise.edrpou, enterpriseCadastralNumbers);
                    enterpriseComparison.enterpriseInfo = enterprise;
                    enterpriseComparisons.push(enterpriseComparison);
                }
                
                // –û–±'—î–¥–Ω—É—î–º–æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∏
                combinedComparison = {
                    foundInGeojson: enterpriseComparisons.reduce((sum, comp) => sum + comp.foundInGeojson, 0),
                    missingInGeojson: enterpriseComparisons.reduce((sum, comp) => sum + comp.missingInGeojson, 0),
                    missingInRrp: enterpriseComparisons.reduce((sum, comp) => sum + comp.missingInRrp, 0),
                    totalCouncilsChecked: Math.max(...enterpriseComparisons.map(comp => comp.totalCouncilsChecked)),
                    missingNumbers: new Set(),
                    extraNumbers: new Set(),
                    missingPlotsDetails: new Map(),
                    extraPlotsDetails: new Map()
                };
                
                // –û–±'—î–¥–Ω—É—î–º–æ –¥–µ—Ç–∞–ª—ñ
                enterpriseComparisons.forEach(comp => {
                    comp.missingNumbers.forEach(num => combinedComparison.missingNumbers.add(num));
                    comp.extraNumbers.forEach(num => combinedComparison.extraNumbers.add(num));
                    comp.missingPlotsDetails.forEach((details, key) => {
                        details.enterpriseInfo = comp.enterpriseInfo;
                        combinedComparison.missingPlotsDetails.set(key, details);
                    });
                    comp.extraPlotsDetails.forEach((details, key) => {
                        details.enterpriseInfo = comp.enterpriseInfo;
                        combinedComparison.extraPlotsDetails.set(key, details);
                    });
                });
            }
            
            const exactMatchPercent = totalCadastralNumbers > 0 ? (combinedComparison.foundInGeojson / totalCadastralNumbers) * 100 : 0;
            const matchPercent = Math.round(exactMatchPercent);

            infoContainer.querySelector('.card-body').innerHTML = `
                <!-- –ö–æ–º–ø–∞–∫—Ç–Ω–∞ —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—è –ø—Ä–æ –ø—ñ–¥–ø—Ä–∏—î–º—Å—Ç–≤–æ(–∞) -->
                <div class="row align-items-center mb-2">
                    <div class="col">
                        <div class="d-flex align-items-center justify-content-between">
                            <div class="d-flex align-items-center">
                                <div class="bg-primary bg-opacity-10 p-2 rounded me-2" style="width: 32px; height: 32px; display: flex; align-items: center; justify-content: center;">
                                    <i class="bi bi-building-fill text-primary" style="font-size: 14px;"></i>
                                </div>
                                <div>
                                    <h6 class="mb-0 text-truncate" style="max-width: 300px;">${title}</h6>
                                    <div class="d-flex align-items-center gap-2 mt-1">
                                        ${enterpriseDataArray.length > 1 ? `
                                            <span class="badge bg-secondary" style="font-size: 10px;">${enterpriseDataArray.length} –ø—ñ–¥–ø—Ä–∏—î–º—Å—Ç–≤</span>
                                            <small class="text-muted">–Ñ–î–†–ü–û–£: ${edrpouNumbers}</small>
                                        ` : `
                                            <span class="badge bg-primary" style="font-size: 10px;">${enterpriseDataArray[0].edrpou}</span>
                                            <small class="text-muted">
                                                <i class="bi bi-calendar-check me-1"></i>${enterpriseDataArray[0].actualityDate}
                                            </small>
                                        `}
                                    </div>
                                </div>
                            </div>
                            <div class="text-end">
                                <div class="h6 mb-0 text-${combinedComparison.missingInGeojson === 0 ? 'success' : 'warning'}">
                                    ${exactMatchPercent === 100 ? '100' : exactMatchPercent.toFixed(1)}%
                                </div>
                                <small class="text-muted">–≤—ñ–¥–ø–æ–≤—ñ–¥–Ω—ñ—Å—Ç—å</small>
                            </div>
                        </div>
                    </div>
                </div>

                ${enterpriseDataArray.length > 1 ? `
                    <!-- –î–µ—Ç–∞–ª—å–Ω–∞ —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—è –ø—Ä–æ –∫–æ–∂–Ω–µ –ø—ñ–¥–ø—Ä–∏—î–º—Å—Ç–≤–æ -->
                    <div class="border rounded p-2 mb-3 bg-light">
                        <h6 class="text-muted mb-2">
                            <i class="bi bi-buildings me-1"></i>
                            –ü—ñ–¥–ø—Ä–∏—î–º—Å—Ç–≤–∞ –≤ –≥—Ä—É–ø—ñ:
                        </h6>
                        ${enterpriseDataArray.map(enterprise => `
                            <div class="d-flex justify-content-between align-items-center py-1 border-bottom border-light">
                                <div>
                                    <strong>${enterprise.enterpriseName}</strong>
                                    <span class="badge bg-primary ms-2" style="font-size: 10px;">${enterprise.edrpou}</span>
                                </div>
                                <div class="text-end">
                                    <small class="text-muted">
                                        ${enterprise.cadastralNumbers.length} –¥–æ–≥–æ–≤–æ—Ä—ñ–≤ ‚Ä¢ ${enterprise.actualityDate}
                                    </small>
                                </div>
                            </div>
                        `).join('')}
                    </div>
                ` : ''}

                <!-- –ö–æ–º–ø–∞–∫—Ç–Ω–∞ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ -->
                <div class="row g-1 mb-2">
                    <div class="col-4">
                        <div class="bg-info bg-opacity-10 px-2 py-1 rounded text-center">
                            <div class="fw-semibold text-info mb-0">${totalCadastralNumbers}</div>
                            <small class="text-muted" style="font-size: 10px;">–¥–æ–≥–æ–≤–æ—Ä—ñ–≤ –†–†–ü</small>
                        </div>
                    </div>
                    <div class="col-4">
                        <div class="bg-success bg-opacity-10 px-2 py-1 rounded text-center">
                            <div class="fw-semibold text-success mb-0">${combinedComparison.foundInGeojson}</div>
                            <small class="text-muted" style="font-size: 10px;">–∑–Ω–∞–π–¥–µ–Ω–æ –≤ –î–ó–ö</small>
                        </div>
                    </div>
                    <div class="col-4">
                        <div class="bg-secondary bg-opacity-10 px-2 py-1 rounded text-center">
                            <div class="fw-semibold text-secondary mb-0">${combinedComparison.totalCouncilsChecked}</div>
                            <small class="text-muted" style="font-size: 10px;">—Ä–∞–¥ –ø–µ—Ä–µ–≤—ñ—Ä–µ–Ω–æ</small>
                        </div>
                    </div>
                </div>

                <!-- –ú—ñ–Ω—ñ –ø—Ä–æ–≥—Ä–µ—Å-–±–∞—Ä -->
                <div class="mb-2">
                    <div class="progress" style="height: 8px;">
                        <div class="progress-bar bg-success" style="width: ${exactMatchPercent}%" 
                             title="–°–ø—ñ–≤–ø–∞–¥—ñ–Ω–Ω—è: ${exactMatchPercent.toFixed(1)}%">
                        </div>
                    </div>
                    <div class="d-flex justify-content-between mt-1">
                        <small class="text-muted" style="font-size: 10px;">
                            <i class="bi bi-arrow-left-right me-1"></i>–°–ø—ñ–≤—Å—Ç–∞–≤–ª–µ–Ω–Ω—è —Ä–µ—î—Å—Ç—Ä—ñ–≤
                        </small>
                        <small class="text-muted" style="font-size: 10px;">
                            ${exactMatchPercent.toFixed(1)}% –≤—ñ–¥–ø–æ–≤—ñ–¥–Ω—ñ—Å—Ç—å
                        </small>
                    </div>
                </div>                ${combinedComparison.missingInGeojson > 0 || combinedComparison.missingInRrp > 0 ? `
                    <!-- –ë–ª–æ–∫ –∑ –ø—Ä–æ–±–ª–µ–º–Ω–∏–º–∏ –¥—ñ–ª—è–Ω–∫–∞–º–∏ -->
                    <div class="card border-warning">
                        <div class="card-header bg-warning bg-opacity-10">
                            <h6 class="mb-0 text-warning">
                                <i class="bi bi-exclamation-triangle me-2"></i>
                                –í–∏—è–≤–ª–µ–Ω—ñ –Ω–µ–≤—ñ–¥–ø–æ–≤—ñ–¥–Ω–æ—Å—Ç—ñ —Ä–µ—î—Å—Ç—Ä—ñ–≤
                            </h6>
                        </div>
                        <div class="card-body">
                            ${combinedComparison.missingInGeojson > 0 ? `
                                <div class="d-flex align-items-center justify-content-between mb-3">
                                    <div>                                        <p class="mb-1">
                                            <strong>${combinedComparison.missingInGeojson} –∑ ${totalCadastralNumbers}</strong> –∫–∞–¥–∞—Å—Ç—Ä–æ–≤–∏—Ö –Ω–æ–º–µ—Ä—ñ–≤ 
                                            –º–∞—é—Ç—å –∑–∞—Ä–µ—î—Å—Ç—Ä–æ–≤–∞–Ω—ñ –¥–æ–≥–æ–≤–æ—Ä–∏ –æ—Ä–µ–Ω–¥–∏ –≤ –†–†–ü, –∞–ª–µ –º–∞—é—Ç—å —Ä–æ–∑–±—ñ–∂–Ω–æ—Å—Ç—ñ –≤ –î–ó–ö
                                            <span class="text-danger fw-semibold">(${((combinedComparison.missingInGeojson / totalCadastralNumbers) * 100).toFixed(1)}%)</span>
                                        </p>
                                        <small class="text-muted">
                                            –î—ñ–ª—è–Ω–∫–∏ –º–æ–∂—É—Ç—å –±—É—Ç–∏ –≤—ñ–¥—Å—É—Ç–Ω—ñ –≤ –î–ó–ö, –º–∞—Ç–∏ —ñ–Ω—à–æ–≥–æ –æ—Ä–µ–Ω–¥–∞—Ä—è –∞–±–æ –Ω–µ –º–∞—Ç–∏ –∞–∫—Ç–∏–≤–Ω–æ—ó –æ—Ä–µ–Ω–¥–∏
                                        </small>
                                    </div>
                                    <div class="text-end">                                        <button class="btn btn-outline-danger btn-sm" type="button" 
                                                data-bs-toggle="collapse" data-bs-target="#missingInDzk" 
                                                aria-expanded="false">
                                            <i class="bi bi-list me-1"></i>
                                            –†–æ–∑–±—ñ–∂–Ω–æ—Å—Ç—ñ –≤ –î–ó–ö
                                        </button>
                                    </div>
                                </div>
                                  <div class="collapse" id="missingInDzk">
                                    <div class="border-top pt-3 mb-3">                                        <h6 class="text-muted mb-3">
                                            <i class="bi bi-file-earmark-x me-1"></i>
                                            –î–µ—Ç–∞–ª—å–Ω–∞ —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—è –ø—Ä–æ –¥—ñ–ª—è–Ω–∫–∏ –∑ —Ä–æ–∑–±—ñ–∂–Ω–æ—Å—Ç—è–º–∏ –≤ –î–ó–ö:
                                        </h6>
                                        <div style="max-height: 400px; overflow-y: auto;">
                                            ${combinedComparison.missingPlotsDetails.size > 0 ? `
                                                <div class="table-responsive">
                                                    <table class="table table-sm table-striped">                                                        <thead class="table-dark">
                                                            <tr>
                                                                <th>–ö–∞–¥–∞—Å—Ç—Ä–æ–≤–∏–π –Ω–æ–º–µ—Ä</th>
                                                                ${enterpriseDataArray.length > 1 ? '<th>–ü—ñ–¥–ø—Ä–∏—î–º—Å—Ç–≤–æ</th>' : ''}
                                                                <th>–ü–æ—Ç–æ—á–Ω–∏–π –æ—Ä–µ–Ω–¥–∞—Ä –≤ –î–ó–ö</th>
                                                                <th>–†–∞–¥–∞</th>
                                                                <th>–°—Ç–∞—Ç—É—Å</th>
                                                                <th>–ü—Ä–∏–º—ñ—Ç–∫–∞</th>
                                                            </tr>
                                                        </thead>
                                                        <tbody>
                                                            ${Array.from(combinedComparison.missingPlotsDetails.values()).map(plot => `
                                                                <tr>
                                                                    <td class="font-monospace">${plot.cadastral}</td>
                                                                    ${enterpriseDataArray.length > 1 ? `<td><span class="badge bg-primary">${plot.enterpriseInfo ? plot.enterpriseInfo.edrpou : '–ù/–î'}</span><br><small>${plot.enterpriseInfo ? plot.enterpriseInfo.enterpriseName : ''}</small></td>` : ''}
                                                                    <td>${plot.tenant}</td>
                                                                    <td>${plot.council}</td>
                                                                    <td><span class="badge ${plot.status === '–í—ñ–¥—Å—É—Ç–Ω—è –≤ –î–ó–ö' ? 'bg-danger' : 'bg-warning text-dark'}">${plot.status}</span></td>
                                                                    <td class="text-muted">${plot.status === '–í—ñ–¥—Å—É—Ç–Ω—è –≤ –î–ó–ö' ? '–Ñ –¥–æ–≥–æ–≤—ñ—Ä –æ—Ä–µ–Ω–¥–∏ –≤ –†–†–ü, –∞–ª–µ –Ω–µ–º–∞—î –º–µ–∂ –≤ –î–ó–ö' : '–Ñ –º–µ–∂—ñ –≤ –î–ó–ö, –∞–ª–µ —ñ–Ω—à–∏–π –æ—Ä–µ–Ω–¥–∞—Ä –∞–±–æ –Ω–µ–º–∞—î –æ—Ä–µ–Ω–¥–∏'}</td>
                                                                </tr>
                                                            `).join('')}
                                                        </tbody>
                                                    </table>
                                                </div>
                                            ` : `
                                                <div class="text-center text-muted py-3">
                                                    <i class="bi bi-check-circle fs-1"></i>
                                                    <p class="mt-2">–£—Å—ñ –¥—ñ–ª—è–Ω–∫–∏ –∑ –†–†–ü –∑–Ω–∞–π–¥–µ–Ω—ñ –≤ –î–ó–ö</p>
                                                </div>
                                            `}
                                        </div>
                                    </div>
                                </div>
                            ` : ''}
                              ${combinedComparison.missingInRrp > 0 ? `
                                <div class="d-flex align-items-center justify-content-between mb-3">
                                    <div>                                        <p class="mb-1">
                                            <strong>${combinedComparison.missingInRrp}</strong> –∫–∞–¥–∞—Å—Ç—Ä–æ–≤–∏—Ö –Ω–æ–º–µ—Ä—ñ–≤ 
                                            –º–∞—é—Ç—å –∑–∞—Ä–µ—î—Å—Ç—Ä–æ–≤–∞–Ω—É –æ—Ä–µ–Ω–¥—É –≤ –î–ó–ö –∑–∞ —Ü–∏–º –ø—ñ–¥–ø—Ä–∏—î–º—Å—Ç–≤–æ–º, –∞–ª–µ –≤—ñ–¥—Å—É—Ç–Ω—ñ –≤ –†–†–ü
                                        </p>
                                        <small class="text-muted">
                                            –ú–æ–∂–ª–∏–≤–æ –∑–∞–≤–µ—Ä—à–µ–Ω—ñ –¥–æ–≥–æ–≤–æ—Ä–∏ –æ—Ä–µ–Ω–¥–∏ –∞–±–æ —Ä–æ–∑–±—ñ–∂–Ω–æ—Å—Ç—ñ –º—ñ–∂ —Ä–µ—î—Å—Ç—Ä–∞–º–∏
                                        </small>
                                    </div>
                                    <div class="text-end">
                                        <button class="btn btn-outline-info btn-sm" type="button" 
                                                data-bs-toggle="collapse" data-bs-target="#missingInRrp" 
                                                aria-expanded="false">
                                            <i class="bi bi-list me-1"></i>
                                            –í—ñ–¥—Å—É—Ç–Ω—ñ –≤ –†–†–ü
                                        </button>
                                    </div>
                                </div>
                                  <div class="collapse" id="missingInRrp">
                                    <div class="border-top pt-3">
                                        <h6 class="text-muted mb-3">
                                            <i class="bi bi-file-earmark-plus me-1"></i>
                                            –î–µ—Ç–∞–ª—å–Ω–∞ —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—è –ø—Ä–æ –¥—ñ–ª—è–Ω–∫–∏ –∑ –î–ó–ö, –≤—ñ–¥—Å—É—Ç–Ω—ñ –≤ –†–†–ü:
                                        </h6>
                                        <div style="max-height: 400px; overflow-y: auto;">
                                            ${combinedComparison.extraPlotsDetails.size > 0 ? `
                                                <div class="table-responsive">
                                                    <table class="table table-sm table-striped">                                                        <thead class="table-dark">
                                                            <tr>
                                                                <th>–ö–∞–¥–∞—Å—Ç—Ä–æ–≤–∏–π –Ω–æ–º–µ—Ä</th>
                                                                ${enterpriseDataArray.length > 1 ? '<th>–ü—ñ–¥–ø—Ä–∏—î–º—Å—Ç–≤–æ</th>' : ''}
                                                                <th>–í–ª–∞—Å–Ω–∏–∫</th>
                                                                <th>–û—Ä–µ–Ω–¥–∞—Ä</th>
                                                                <th>–ü–ª–æ—â–∞ (–≥–∞)</th>
                                                                <th>–î–∞—Ç–∞ —Ä–µ—î—Å—Ç—Ä–∞—Ü—ñ—ó</th>
                                                                <th>–†–∞–¥–∞</th>
                                                                <th>–°—Ç–∞—Ç—É—Å</th>
                                                            </tr>
                                                        </thead>
                                                        <tbody>                                                            ${Array.from(combinedComparison.extraPlotsDetails.values()).map(plot => `
                                                                <tr>
                                                                    <td class="font-monospace">${plot.cadastral}</td>
                                                                    ${enterpriseDataArray.length > 1 ? `<td><span class="badge bg-primary">${plot.enterpriseInfo ? plot.enterpriseInfo.edrpou : '–ù/–î'}</span><br><small>${plot.enterpriseInfo ? plot.enterpriseInfo.enterpriseName : ''}</small></td>` : ''}
                                                                    <td>${plot.owner}</td>
                                                                    <td>${plot.tenant}</td>
                                                                    <td class="text-end">${plot.area}</td>
                                                                    <td>${plot.registrationDate}</td>
                                                                    <td>${plot.council}</td>
                                                                    <td><span class="badge bg-info">${plot.status}</span></td>
                                                                </tr>
                                                            `).join('')}
                                                        </tbody>
                                                    </table>
                                                </div>
                                            ` : `
                                                <div class="text-center text-muted py-3">
                                                    <i class="bi bi-check-circle fs-1"></i>
                                                    <p class="mt-2">–£—Å—ñ –¥—ñ–ª—è–Ω–∫–∏ –∑ –î–ó–ö –ø—Ä–∏—Å—É—Ç–Ω—ñ –≤ –†–†–ü</p>
                                                </div>
                                            `}
                                        </div>
                                    </div>
                                </div>
                            ` : ''}
                        </div>
                    </div>
                ` : `
                    <!-- –ë–ª–æ–∫ —É—Å–ø—ñ—à–Ω–æ–≥–æ —Å–ø—ñ–≤–ø–∞–¥—ñ–Ω–Ω—è -->
                    <div class="card border-success">
                        <div class="card-body text-center">
                            <div class="text-success mb-2">
                                <i class="bi bi-check-circle-fill fs-1"></i>
                            </div>
                            <h6 class="text-success">–ü–æ–≤–Ω–∞ –≤—ñ–¥–ø–æ–≤—ñ–¥–Ω—ñ—Å—Ç—å —Ä–µ—î—Å—Ç—Ä—ñ–≤</h6>
                            <p class="text-muted mb-0">
                                –í—Å—ñ –¥–æ–≥–æ–≤–æ—Ä–∏ –æ—Ä–µ–Ω–¥–∏ –∑ –†–†–ü –º–∞—é—Ç—å –≤—ñ–¥–ø–æ–≤—ñ–¥–Ω—ñ –º–µ–∂—ñ –¥—ñ–ª—è–Ω–æ–∫ –≤ –î–ó–ö
                            </p>
                        </div>
                    </div>
                `}

                <!-- –î–æ–¥–∞—Ç–∫–æ–≤–∞ —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—è -->                <div class="text-center mt-4 pt-3 border-top">                    <small class="text-muted">
                        <i class="bi bi-info-circle me-1"></i>
                        –î–∞–Ω—ñ –∞–∫—Ç—É–∞–ª—å–Ω—ñ —Å—Ç–∞–Ω–æ–º –Ω–∞ ${enterpriseDataArray[0].actualityDate} ‚Ä¢ 
                        –ü–µ—Ä–µ–≤—ñ—Ä–µ–Ω–æ ${combinedComparison.totalCouncilsChecked} —Ä–∞–¥(–∏) ‚Ä¢ 
                        –§–∞–π–ª—ñ–≤ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–æ: ${enterpriseDataArray.length}
                    </small>
                </div>
            `;
            
            // –ü–æ–∫–∞–∑—É—î–º–æ –∫–æ–ª–æ–Ω–∫–∏ –∑ –±–µ–π–¥–∂–∞–º–∏ —Ç–µ–ø–µ—Ä, –∫–æ–ª–∏ —î –¥–∞–Ω—ñ –ø—ñ–¥–ø—Ä–∏—î–º—Å—Ç–≤–∞
            const badgeHeaders = document.querySelectorAll('.badge-column');
            badgeHeaders.forEach(header => {
                header.style.display = 'table-cell';
            });
            
            // –û–Ω–æ–≤–ª—é—î–º–æ —ñ—Å–Ω—É—é—á—ñ —Ä—è–¥–∫–∏ —Ç–∞–±–ª–∏—Ü—ñ –∑ –Ω–æ–≤–∏–º–∏ –¥–∞–Ω–∏–º–∏ –±–µ–π–¥–∂—ñ–≤
            const tableRows = document.querySelectorAll('#tableBody tr');
            tableRows.forEach(row => {
                const councilName = row.cells[0].textContent.trim().replace(/^\s*[^\s]+\s+/, ''); // –í–∏–¥–∞–ª—è—î–º–æ —ñ–∫–æ–Ω–∫—É
                const missingInDzkCount = councilMissingInDzk.get(councilName) || 0;
                const missingInRrpCount = councilMissingInRrp.get(councilName) || 0;
                
                // –û–Ω–æ–≤–ª—é—î–º–æ –æ—Å—Ç–∞–Ω–Ω—ñ –¥–≤—ñ –∫–æ–º—ñ—Ä–∫–∏ (–±–µ–π–¥–∂—ñ)
                if (row.cells.length >= 8) {                    row.cells[6].innerHTML = `
                        <span class="badge ${missingInDzkCount > 0 ? 'bg-warning text-dark' : 'bg-success'}" title="${missingInDzkCount > 0 ? missingInDzkCount + ' —Ä–æ–∑–±—ñ–∂–Ω–æ—Å—Ç–µ–π –≤ –î–ó–ö' : '–í—Å—ñ –∑–Ω–∞–π–¥–µ–Ω—ñ –≤ –î–ó–ö –∑ –ø—Ä–∞–≤–∏–ª—å–Ω–∏–º –æ—Ä–µ–Ω–¥–∞—Ä–µ–º'}">
                            ${missingInDzkCount}
                        </span>
                    `;
                    row.cells[6].style.display = 'table-cell';
                    
                    row.cells[7].innerHTML = `
                        <span class="badge ${missingInRrpCount > 0 ? 'bg-warning text-dark' : 'bg-success'}" title="${missingInRrpCount > 0 ? missingInRrpCount + ' –≤—ñ–¥—Å—É—Ç–Ω—ñ—Ö –≤ –†–†–ü' : '–í—Å—ñ –∑–Ω–∞–π–¥–µ–Ω—ñ –≤ –†–†–ü'}">
                            ${missingInRrpCount}
                        </span>
                    `;
                    row.cells[7].style.display = 'table-cell';
                }
            });
        }        async function compareWithGeojson(edrpou, txtCadastralNumbers) {
            const comparison = {
                foundInGeojson: 0,
                missingInGeojson: 0, // –Ñ –≤ –†–†–ü, –Ω–µ–º–∞—î –≤ –î–ó–ö
                missingInRrp: 0,     // –Ñ –≤ –î–ó–ö, –Ω–µ–º–∞—î –≤ –†–†–ü
                totalCouncilsChecked: 0,
                missingNumbers: new Set(),      // –ù–æ–º–µ—Ä–∏ –≤—ñ–¥—Å—É—Ç–Ω—ñ –≤ –î–ó–ö
                extraNumbers: new Set(),        // –ù–æ–º–µ—Ä–∏ –≤—ñ–¥—Å—É—Ç–Ω—ñ –≤ –†–†–ü
                missingPlotsDetails: new Map(), // –î–µ—Ç–∞–ª—å–Ω–∞ —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—è –ø—Ä–æ –≤—ñ–¥—Å—É—Ç–Ω—ñ –≤ –î–ó–ö
                extraPlotsDetails: new Map()    // –î–µ—Ç–∞–ª—å–Ω–∞ —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—è –ø—Ä–æ –≤—ñ–¥—Å—É—Ç–Ω—ñ –≤ –†–†–ü
            };

            // –û—á–∏—â–∞—î–º–æ –ø–æ–ø–µ—Ä–µ–¥–Ω—ñ –¥–∞–Ω—ñ
            councilMissingInDzk.clear();
            councilMissingInRrp.clear();

            try {
                // –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î–º–æ –≥–ª–æ–±–∞–ª—å–Ω—ñ –∑–º—ñ–Ω–Ω—ñ
                const dataPath = globalDataPath;
                
                const response = await fetch(dataPath + 'file_list.json');
                const data = await response.json();
                
                // –û–±—Ä–æ–±–ª—è—î–º–æ –∫–æ–∂–Ω—É —Ä–∞–¥—É –æ–∫—Ä–µ–º–æ
                for (const file of data.files) {
                    const councilName = file.replace('.geojson', '');
                    const councilCadastralNumbers = new Set();
                    let councilMissingInDzkCount = 0;
                    let councilMissingInRrpCount = 0;
                    
                    try {
                        const geojsonResponse = await fetch(dataPath + file);
                        const geojsonData = await geojsonResponse.json();
                        comparison.totalCouncilsChecked++;                          // –ó–±–∏—Ä–∞—î–º–æ –∫–∞–¥–∞—Å—Ç—Ä–æ–≤—ñ –Ω–æ–º–µ—Ä–∏ —Ü—ñ—î—ó —Ä–∞–¥–∏ –¥–ª—è –Ω–∞—à–æ–≥–æ –Ñ–î–†–ü–û–£ —Ç–∞ –¥–µ—Ç–∞–ª—å–Ω—É —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—é
                        const councilPlotsDetails = new Map(); // –ó–±–µ—Ä—ñ–≥–∞—î–º–æ –¥–µ—Ç–∞–ª—å–Ω—É —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—é –ø—Ä–æ –¥—ñ–ª—è–Ω–∫–∏ –∑ –Ω–∞—à–∏–º –Ñ–î–†–ü–û–£
                        const allCouncilPlots = new Map(); // –ó–±–µ—Ä—ñ–≥–∞—î–º–æ –≤—Å—ñ –¥—ñ–ª—è–Ω–∫–∏ —Ä–∞–¥–∏ (–¥–ª—è –ø–µ—Ä–µ–≤—ñ—Ä–∫–∏ —ñ—Å–Ω—É–≤–∞–Ω–Ω—è)
                        
                        geojsonData.features.forEach(feature => {
                            const props = feature.properties;
                            const cadastralNumber = props?.['–ö–∞–¥–∞—Å—Ç—Ä–æ–≤–∏–π –Ω–æ–º–µ—Ä'];
                            
                            if (cadastralNumber) {
                                // –ó–±–µ—Ä—ñ–≥–∞—î–º–æ —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—é –ø—Ä–æ –≤—Å—ñ –¥—ñ–ª—è–Ω–∫–∏ —Ä–∞–¥–∏
                                if (!allCouncilPlots.has(cadastralNumber)) {
                                    allCouncilPlots.set(cadastralNumber, {
                                        cadastral: cadastralNumber,
                                        owner: props['–í–ª–∞—Å–Ω–∏–∫'] || '',
                                        tenant: props['–û—Ä–µ–Ω–¥–∞—Ä'] || props['–û—Ä–µ–Ω–¥–∞—Ä —á–∞—Å—Ç–∏–Ω–∏'] || '',
                                        tenantEdrpou: props['–Ñ–î–†–ü–û–£ –æ—Ä–µ–Ω–¥–∞—Ä—è –¥—ñ–ª—è–Ω–∫–∏'] || '',
                                        area: props['–ü–ª–æ—â–∞ —Ä–æ–∑—Ä–∞—Ö–æ–≤–∞–Ω–∞'] || props['–ü–ª–æ—â–∞ —á–∞—Å—Ç–∏–Ω–∏'] || '',
                                        registrationDate: props['–î–∞—Ç–∞ —Ä–µ—î—Å—Ç—Ä–∞—Ü—ñ—ó –æ—Ä–µ–Ω–¥–∏'] || '',
                                        expiryDate: props['–î–∞—Ç–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–Ω—è'] || '',
                                        status: props['–°—Ç–∞—Ç—É—Å'] || '',
                                        field: props['–ù–∞–∑–≤–∞ –ø–æ–ª—è'] || '',
                                        council: councilName
                                    });
                                }
                                
                                // –Ø–∫—â–æ –¥—ñ–ª—è–Ω–∫–∞ –∑ –Ω–∞—à–∏–º –Ñ–î–†–ü–û–£
                                if (props['–Ñ–î–†–ü–û–£ –æ—Ä–µ–Ω–¥–∞—Ä—è –¥—ñ–ª—è–Ω–∫–∏'] === edrpou) {
                                    councilCadastralNumbers.add(cadastralNumber);
                                    // –ó–±–µ—Ä—ñ–≥–∞—î–º–æ –¥–µ—Ç–∞–ª—å–Ω—É —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—é –ø—Ä–æ –¥—ñ–ª—è–Ω–∫—É –∑ –Ω–∞—à–∏–º –Ñ–î–†–ü–û–£
                                    if (!councilPlotsDetails.has(cadastralNumber)) {
                                        councilPlotsDetails.set(cadastralNumber, {
                                            cadastral: cadastralNumber,
                                            owner: props['–í–ª–∞—Å–Ω–∏–∫'] || '',
                                            tenant: props['–û—Ä–µ–Ω–¥–∞—Ä'] || props['–û—Ä–µ–Ω–¥–∞—Ä —á–∞—Å—Ç–∏–Ω–∏'] || '',
                                            area: props['–ü–ª–æ—â–∞ —Ä–æ–∑—Ä–∞—Ö–æ–≤–∞–Ω–∞'] || props['–ü–ª–æ—â–∞ —á–∞—Å—Ç–∏–Ω–∏'] || '',
                                            registrationDate: props['–î–∞—Ç–∞ —Ä–µ—î—Å—Ç—Ä–∞—Ü—ñ—ó –æ—Ä–µ–Ω–¥–∏'] || '',
                                            expiryDate: props['–î–∞—Ç–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–Ω—è'] || '',
                                            status: props['–°—Ç–∞—Ç—É—Å'] || '',
                                            field: props['–ù–∞–∑–≤–∞ –ø–æ–ª—è'] || '',
                                            council: councilName
                                        });
                                    }
                                }
                            }
                        });
                        
                        // –í–∏–∑–Ω–∞—á–∞—î–º–æ –ö–û–ê–¢–£–£ —Ü—ñ—î—ó —Ä–∞–¥–∏
                        let councilKoatuu = null;
                        const firstFeature = geojsonData.features.find(f => f.properties?.['–ö–∞–¥–∞—Å—Ç—Ä–æ–≤–∏–π –Ω–æ–º–µ—Ä']);
                        if (firstFeature) {
                            councilKoatuu = firstFeature.properties['–ö–∞–¥–∞—Å—Ç—Ä–æ–≤–∏–π –Ω–æ–º–µ—Ä'].substring(0, 10);
                        }                          // 1. –ü–µ—Ä–µ–≤—ñ—Ä—è—î–º–æ –Ω–æ–º–µ—Ä–∏ –∑ –†–†–ü - —á–∏ —î –≤–æ–Ω–∏ –≤ –î–ó–ö –∑ –ø—Ä–∞–≤–∏–ª—å–Ω–∏–º –æ—Ä–µ–Ω–¥–∞—Ä–µ–º
                        txtCadastralNumbers.forEach(txtNumber => {
                            if (councilCadastralNumbers.has(txtNumber)) {
                                // –î—ñ–ª—è–Ω–∫–∞ –∑–Ω–∞–π–¥–µ–Ω–∞ –∑ –ø—Ä–∞–≤–∏–ª—å–Ω–∏–º –æ—Ä–µ–Ω–¥–∞—Ä–µ–º
                                comparison.foundInGeojson++;
                            } else {
                                // –ü–µ—Ä–µ–≤—ñ—Ä—è—î–º–æ —á–∏ —Ü–µ–π –Ω–æ–º–µ—Ä –Ω–∞–ª–µ–∂–∏—Ç—å –¥–æ —Ü—ñ—î—ó —Ä–∞–¥–∏ (–∑–∞ –ö–û–ê–¢–£–£)
                                if (txtNumber.length >= 10 && councilKoatuu) {
                                    const txtKoatuu = txtNumber.substring(0, 10);
                                    if (txtKoatuu === councilKoatuu) {
                                        // –ü–µ—Ä–µ–≤—ñ—Ä—è—î–º–æ —á–∏ –¥—ñ–ª—è–Ω–∫–∞ —ñ—Å–Ω—É—î –≤–∑–∞–≥–∞–ª—ñ –≤ –î–ó–ö
                                        const existingPlot = allCouncilPlots.get(txtNumber);
                                        
                                        if (existingPlot) {
                                            // –î—ñ–ª—è–Ω–∫–∞ —ñ—Å–Ω—É—î, –∞–ª–µ –∑ —ñ–Ω—à–∏–º –æ—Ä–µ–Ω–¥–∞—Ä–µ–º –∞–±–æ –±–µ–∑ –æ—Ä–µ–Ω–¥–∏
                                            councilMissingInDzkCount++;
                                            comparison.missingInGeojson++;
                                            comparison.missingNumbers.add(txtNumber);
                                            
                                            const currentTenant = existingPlot.tenant || '–í—ñ–¥—Å—É—Ç–Ω—ñ–π';
                                            const currentTenantEdrpou = existingPlot.tenantEdrpou || '–í—ñ–¥—Å—É—Ç–Ω—ñ–π';
                                            
                                            comparison.missingPlotsDetails.set(txtNumber, {
                                                cadastral: txtNumber,
                                                owner: existingPlot.owner,
                                                tenant: `${currentTenant} (–Ñ–î–†–ü–û–£: ${currentTenantEdrpou})`,
                                                area: existingPlot.area,
                                                registrationDate: existingPlot.registrationDate,
                                                expiryDate: existingPlot.expiryDate,
                                                status: currentTenantEdrpou ? '–Ü–Ω—à–∏–π –æ—Ä–µ–Ω–¥–∞—Ä –≤ –î–ó–ö' : '–ù–µ–º–∞—î –æ—Ä–µ–Ω–¥–∏ –≤ –î–ó–ö',
                                                field: existingPlot.field,
                                                council: councilName
                                            });
                                        } else {
                                            // –î—ñ–ª—è–Ω–∫–∞ –≤–∑–∞–≥–∞–ª—ñ –≤—ñ–¥—Å—É—Ç–Ω—è –≤ –î–ó–ö
                                            councilMissingInDzkCount++;
                                            comparison.missingInGeojson++;
                                            comparison.missingNumbers.add(txtNumber);
                                            
                                            comparison.missingPlotsDetails.set(txtNumber, {
                                                cadastral: txtNumber,
                                                owner: '–ù–µ–≤—ñ–¥–æ–º–æ (–Ω–µ–º–∞—î –≤ –î–ó–ö)',
                                                tenant: '–ù–µ–≤—ñ–¥–æ–º–æ (–Ω–µ–º–∞—î –≤ –î–ó–ö)',
                                                area: '–ù–µ–≤—ñ–¥–æ–º–æ (–Ω–µ–º–∞—î –≤ –î–ó–ö)',
                                                registrationDate: '–ù–µ–≤—ñ–¥–æ–º–æ (–Ω–µ–º–∞—î –≤ –î–ó–ö)',
                                                expiryDate: '–ù–µ–≤—ñ–¥–æ–º–æ (–Ω–µ–º–∞—î –≤ –î–ó–ö)',
                                                status: '–í—ñ–¥—Å—É—Ç–Ω—è –≤ –î–ó–ö',
                                                field: '–ù–µ–≤—ñ–¥–æ–º–æ (–Ω–µ–º–∞—î –≤ –î–ó–ö)',
                                                council: councilName
                                            });
                                        }
                                    }
                                }
                            }
                        });
                        
                        // 2. –ü–µ—Ä–µ–≤—ñ—Ä—è—î–º–æ –Ω–æ–º–µ—Ä–∏ –∑ –î–ó–ö - —á–∏ —î –≤–æ–Ω–∏ –≤ –†–†–ü
                        councilCadastralNumbers.forEach(geojsonNumber => {
                            if (!txtCadastralNumbers.has(geojsonNumber)) {
                                councilMissingInRrpCount++;
                                comparison.missingInRrp++;
                                comparison.extraNumbers.add(geojsonNumber);
                                
                                // –î–æ–¥–∞—î–º–æ –¥–µ—Ç–∞–ª—å–Ω—É —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—é –¥–ª—è –≤—ñ–¥—Å—É—Ç–Ω—ñ—Ö –≤ –†–†–ü (–∑ –ø–æ–≤–Ω–∏–º–∏ –¥–∞–Ω–∏–º–∏ –∑ –î–ó–ö)
                                const plotDetails = councilPlotsDetails.get(geojsonNumber);
                                if (plotDetails) {
                                    plotDetails.status = '–í—ñ–¥—Å—É—Ç–Ω—è –≤ –†–†–ü';
                                    comparison.extraPlotsDetails.set(geojsonNumber, plotDetails);
                                }
                            }
                        });
                        
                    } catch (error) {
                        console.warn(`–ü–æ–º–∏–ª–∫–∞ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è —Ñ–∞–π–ª—É ${file}:`, error);
                    }
                    
                    // –ó–±–µ—Ä—ñ–≥–∞—î–º–æ –¥–∞–Ω—ñ –ø—Ä–æ —Ä–æ–∑–±—ñ–∂–Ω–æ—Å—Ç—ñ –¥–ª—è —Ü—ñ—î—ó —Ä–∞–¥–∏
                    councilMissingInDzk.set(councilName, councilMissingInDzkCount);
                    councilMissingInRrp.set(councilName, councilMissingInRrpCount);
                }

            } catch (error) {
                console.error('–ü–æ–º–∏–ª–∫–∞ –ø–æ—Ä—ñ–≤–Ω—è–Ω–Ω—è –∑ geojson —Ñ–∞–π–ª–∞–º–∏:', error);
            }

            return comparison;
        }        async function loadAndAnalyzeData(dataPath, hasEnterpriseData = false) {
            perfMonitor.start('loadAndAnalyzeData_total');
            
            try {
                // –ü–æ–∫–∞–∑—É—î–º–æ —ñ–Ω–¥–∏–∫–∞—Ç–æ—Ä –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è
                showLoadingIndicator('–ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è —Å–ø–∏—Å–∫—É —Ñ–∞–π–ª—ñ–≤...');
                
                const fileListData = await dataCache.get(dataPath + 'file_list.json', async () => {
                    const response = await fetch(dataPath + 'file_list.json');
                    if (!response.ok) {
                        throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                    }
                    return response.json();
                });
                
                const grid = document.getElementById('cardsView');
                const tableBody = document.getElementById('tableBody');
                
                // –°—Ö–æ–≤–∞—Ç–∏/–ø–æ–∫–∞–∑–∞—Ç–∏ –∫–æ–ª–æ–Ω–∫–∏ –∑ –±–µ–π–¥–∂–∞–º–∏ –≤ –∑–∞–ª–µ–∂–Ω–æ—Å—Ç—ñ –≤—ñ–¥ –Ω–∞—è–≤–Ω–æ—Å—Ç—ñ –¥–∞–Ω–∏—Ö –ø—ñ–¥–ø—Ä–∏—î–º—Å—Ç–≤–∞
                const badgeHeaders = document.querySelectorAll('.badge-column');
                badgeHeaders.forEach(header => {
                    header.style.display = hasEnterpriseData ? 'table-cell' : 'none';
                });
                
                const totalCouncils = fileListData.files.length;
                showLoadingIndicator(`–ê–Ω–∞–ª—ñ–∑ –¥–∞–Ω–∏—Ö ${totalCouncils} —Ä–∞–¥...`);
                
                // üöÄ –ü–ê–†–ê–õ–ï–õ–¨–ù–ò–ô –ê–ù–ê–õ–Ü–ó –í–°–Ü–• –§–ê–ô–õ–Ü–í
                perfMonitor.start('parallel_analysis');
                const analysisPromises = fileListData.files.map(async (file) => {
                    const filePath = dataPath + file;
                    return await dataCache.get(`analysis_${filePath}`, async () => {
                        perfMonitor.start(`analyze_${file}`);
                        const result = await analyzeCouncilData(filePath);
                        perfMonitor.end(`analyze_${file}`, false);
                        return result;
                    });
                });
                
                const analysisResults = await Promise.all(analysisPromises);
                perfMonitor.end('parallel_analysis');
                
                // üöÄ –û–ü–¢–ò–ú–Ü–ó–û–í–ê–ù–ê –ü–û–ë–£–î–û–í–ê DOM - –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î–º–æ DocumentFragment
                const cardFragment = document.createDocumentFragment();
                const tableFragment = document.createDocumentFragment();
                
                let totalPlots = 0;
                
                analysisResults.forEach((councilData, index) => {
                    const fileName = fileListData.files[index];
                    const councilName = fileName.replace('.geojson', '');
                    
                    // –°—Ç–≤–æ—Ä—é—î–º–æ –∫–∞—Ä—Ç–∫—É
                    const card = createCouncilCard(councilName, councilData, hasEnterpriseData);
                    cardFragment.appendChild(card);
                    
                    totalPlots += councilData.totalRecords;
                });
                
                // –î–æ–¥–∞—î–º–æ –≤—Å—ñ –µ–ª–µ–º–µ–Ω—Ç–∏ –≤ DOM –∑–∞ –æ–¥–∏–Ω —Ä–∞–∑
                grid.appendChild(cardFragment);                // –û–±–Ω–æ–≤–ª—è–µ–º –∑–∞–≥–æ–ª–æ–≤–æ–∫ —Å—Ç–æ—Ä—ñ–Ω–∫–∏
                document.getElementById('pageSubtitle').textContent = `${totalCouncils} —Ä–∞–¥, ${totalPlots.toLocaleString('uk-UA')} –¥—ñ–ª—è–Ω–æ–∫`;
                
                hideLoadingIndicator();
                perfMonitor.end('loadAndAnalyzeData_total');
                console.log(`üèÅ –ó–∞–≤–µ—Ä—à–µ–Ω–æ –∞–Ω–∞–ª—ñ–∑ ${totalCouncils} —Ä–∞–¥, ${totalPlots} –¥—ñ–ª—è–Ω–æ–∫`);
                
                // –õ–æ–≥—É—î–º–æ –¥–µ—Ç–∞–ª—å–Ω—É —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –ø—Ä–æ–¥—É–∫—Ç–∏–≤–Ω–æ—Å—Ç—ñ
                perfMonitor.logSummary();
                
            } catch (error) {
                console.error('‚ùå –ü–æ–º–∏–ª–∫–∞ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –¥–∞–Ω–∏—Ö:', error);
                hideLoadingIndicator();
                showErrorMessage('–ù–µ –≤–¥–∞–ª–æ—Å—è –∑–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏ –¥–∞–Ω—ñ. –°–ø—Ä–æ–±—É–π—Ç–µ –ø—ñ–∑–Ω—ñ—à–µ.');
            }
        }
        
        // üöÄ –§–£–ù–ö–¶–Ü–á –î–õ–Ø –Ü–ù–î–ò–ö–ê–¢–û–†–ê –ó–ê–í–ê–ù–¢–ê–ñ–ï–ù–ù–Ø
        function showLoadingIndicator(message = '–ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è...') {
            let loader = document.getElementById('globalLoader');
            if (!loader) {
                loader = document.createElement('div');
                loader.id = 'globalLoader';
                loader.innerHTML = `
                    <div class="position-fixed top-0 start-0 w-100 h-100 d-flex align-items-center justify-content-center" style="background: rgba(255,255,255,0.9); z-index: 9999;">
                        <div class="text-center">
                            <div class="spinner-border text-primary mb-3" role="status" style="width: 3rem; height: 3rem;">
                                <span class="visually-hidden">–ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è...</span>
                            </div>
                            <h5 id="loadingMessage" class="text-muted">${message}</h5>
                            <div class="progress mt-2" style="width: 300px;">
                                <div class="progress-bar progress-bar-striped progress-bar-animated" style="width: 100%"></div>
                            </div>
                        </div>
                    </div>
                `;
                document.body.appendChild(loader);
            } else {
                loader.style.display = 'block';
                document.getElementById('loadingMessage').textContent = message;
            }
        }
        
        function hideLoadingIndicator() {
            const loader = document.getElementById('globalLoader');
            if (loader) {
                loader.style.display = 'none';
            }
        }
        
        function showErrorMessage(message) {
            const alert = document.createElement('div');
            alert.className = 'alert alert-danger alert-dismissible fade show position-fixed';
            alert.style.cssText = 'top: 20px; right: 20px; z-index: 10000; max-width: 400px;';
            alert.innerHTML = `
                <i class="bi bi-exclamation-triangle-fill me-2"></i>
                ${message}
                <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
            `;
            document.body.appendChild(alert);
            
            // –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –ø—Ä–∏–±–∏—Ä–∞—î–º–æ —á–µ—Ä–µ–∑ 5 —Å–µ–∫—É–Ω–¥
            setTimeout(() => {
                if (alert.parentNode) {
                    alert.remove();
                }
            }, 5000);
        }
        
        // üöÄ LAZY LOADING –°–ò–°–¢–ï–ú–ò –î–õ–Ø –ì–†–ê–§–Ü–ö–Ü–í
        const chartObserver = new IntersectionObserver((entries) => {
            entries.forEach(entry => {
                if (entry.isIntersecting && !entry.target.dataset.chartLoaded) {
                    const chartId = entry.target.dataset.chartId;
                    const statsData = JSON.parse(entry.target.dataset.statsData);
                    const councilName = entry.target.dataset.councilName;
                    
                    createChart(chartId, statsData, councilName);
                    entry.target.dataset.chartLoaded = 'true';
                    
                    // –ü—Ä–∏–ø–∏–Ω—è—î–º–æ —Å–ø–æ—Å—Ç–µ—Ä–µ–∂–µ–Ω–Ω—è –∑–∞ —Ü–∏–º –µ–ª–µ–º–µ–Ω—Ç–æ–º
                    chartObserver.unobserve(entry.target);
                }
            });
        }, {
            root: null,
            rootMargin: '50px', // –ó–∞–≤–∞–Ω—Ç–∞–∂—É—î–º–æ —Ç—Ä–æ—Ö–∏ —Ä–∞–Ω—ñ—à–µ –Ω—ñ–∂ —Å—Ç–∞—î –≤–∏–¥–∏–º–∏–º
            threshold: 0.1
        });
        
        function setupLazyChart(chartContainer, chartId, stats, councilName) {
            // –ó–±–µ—Ä—ñ–≥–∞—î–º–æ –¥–∞–Ω—ñ –≤ data-–∞—Ç—Ä–∏–±—É—Ç–∞—Ö
            chartContainer.dataset.chartId = chartId;
            chartContainer.dataset.statsData = JSON.stringify(stats);
            chartContainer.dataset.councilName = councilName;
            chartContainer.dataset.chartLoaded = 'false';
            
            // –î–æ–¥–∞—î–º–æ –ø–ª–µ–π—Å—Ö–æ–ª–¥–µ—Ä
            chartContainer.innerHTML = `
                <div class="d-flex align-items-center justify-content-center h-100 text-muted">
                    <div class="text-center">
                        <div class="spinner-border spinner-border-sm me-2" role="status">
                            <span class="visually-hidden">–ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è...</span>
                        </div>
                        <small>–ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –≥—Ä–∞—Ñ—ñ–∫—É...</small>
                    </div>
                </div>
            `;
            
            // –ü–æ—á–∏–Ω–∞—î–º–æ —Å–ø–æ—Å—Ç–µ—Ä–µ–∂–µ–Ω–Ω—è
            chartObserver.observe(chartContainer);
        }
        
        function createChart(chartId, stats, councilName) {
            const dates = Object.keys(stats.dailyUpdates).sort();
            const updates = dates.map(date => stats.dailyUpdates[date]);
            
            console.log(`üìä –°—Ç–≤–æ—Ä—é—î–º–æ –≥—Ä–∞—Ñ—ñ–∫ –¥–ª—è ${councilName}`);
            
            // –û—á–∏—â—É—î–º–æ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä —ñ –¥–æ–¥–∞—î–º–æ canvas
            const container = document.querySelector(`[data-chart-id="${chartId}"]`);
            container.innerHTML = `<canvas id="${chartId}"></canvas>`;
            
            new Chart(document.getElementById(chartId), {
                type: 'bar',
                data: {
                    labels: dates.map(date => {
                        const [y, m, d] = date.split('-');
                        return `${d}.${m}`;
                    }),
                    datasets: [{
                        label: '–ö—ñ–ª—å–∫—ñ—Å—Ç—å –æ–Ω–æ–≤–ª–µ–Ω—å',
                        data: updates,
                        backgroundColor: updates.map(value => 
                            value === 0 ? 'rgba(200,200,200,0.2)' : 'rgba(54, 162, 235, 0.5)'
                        ),
                        borderColor: updates.map(value => 
                            value === 0 ? 'rgba(200,200,200,0.5)' : 'rgba(54, 162, 235, 1)'
                        ),
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: {
                                stepSize: Math.max(1, Math.ceil(Math.max(...updates) / 20)),
                                maxTicksLimit: 10
                            }
                        }
                    },
                    plugins: {
                        legend: {
                            display: false
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    const value = context.raw;
                                    return value === 0 ? '–ù–µ–º–∞—î –æ–Ω–æ–≤–ª–µ–Ω—å' : `–û–Ω–æ–≤–ª–µ–Ω–æ: ${value} –¥—ñ–ª—è–Ω–æ–∫`;
                                }
                            }
                        }
                    }
                }
            });
        }

        async function analyzeCouncilData(filePath) {
            // –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î–º–æ –∫–µ—à –¥–ª—è –¥–∞–Ω–∏—Ö
            const data = await dataCache.get(filePath, async () => {
                const response = await fetch(filePath);
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }
                return response.json();
            });
            
            const now = new Date();
            
            // –§—ñ–ª—å—Ç—Ä—É—î–º–æ —Ç—ñ–ª—å–∫–∏ original –∑–∞–ø–∏—Å–∏
            const originalFeatures = data.features.filter(feature => feature.properties?.type === 'original');
            
            let stats = {
                totalRecords: originalFeatures.length,
                fresh: 0,
                medium: 0,
                old: 0,
                noDate: 0,
                latestUpdate: null,
                oldestUpdate: null,
                dailyUpdates: {},
                koatuu: ''
            };

            // –û—Ç—Ä–∏–º—É—î–º–æ –ö–û–ê–¢–£–£ –∑ –ø–µ—Ä—à–æ—ó –¥—ñ–ª—è–Ω–∫–∏
            if (originalFeatures.length > 0) {
                const firstFeature = originalFeatures[0];
                const cadastralNumber = firstFeature.properties?.["–ö–∞–¥–∞—Å—Ç—Ä–æ–≤–∏–π –Ω–æ–º–µ—Ä"];
                if (cadastralNumber) {
                    stats.koatuu = cadastralNumber.substring(0, 10);
                }
            }

            // –ó–±–∏—Ä–∞—î–º–æ –¥–∞–Ω—ñ –æ–Ω–æ–≤–ª–µ–Ω—å
            originalFeatures.forEach(feature => {
                const date = feature.properties?.["–î–∞—Ç–∞ –æ–Ω–æ–≤–ª–µ–Ω–Ω—è"];
                if (!date) {
                    stats.noDate++;
                    return;
                }

                const [day, month, year] = date.split('.').map(Number);
                const updateDate = new Date(year, month - 1, day);
                const monthsOld = (now - updateDate) / (1000 * 60 * 60 * 24 * 30);

                const dateKey = updateDate.toISOString().split('T')[0];
                stats.dailyUpdates[dateKey] = (stats.dailyUpdates[dateKey] || 0) + 1;

                if (!stats.latestUpdate || updateDate > stats.latestUpdate) {
                    stats.latestUpdate = updateDate;
                }
                if (!stats.oldestUpdate || updateDate < stats.oldestUpdate) {
                    stats.oldestUpdate = updateDate;
                }

                if (monthsOld < 1) stats.fresh++;
                else if (monthsOld < 2) stats.medium++;
                else stats.old++;
            });

            // –î–æ–¥–∞—î–º–æ –≤—Å—ñ –¥–Ω—ñ –º—ñ–∂ –Ω–∞–π—Å—Ç–∞—Ä—ñ—à–æ—é —ñ –Ω–∞–π–Ω–æ–≤—ñ—à–æ—é –¥–∞—Ç–æ—é
            if (stats.oldestUpdate && stats.latestUpdate) {
                const currentDate = new Date(stats.oldestUpdate);
                while (currentDate <= stats.latestUpdate) {
                    const dateKey = currentDate.toISOString().split('T')[0];
                    if (!stats.dailyUpdates[dateKey]) {
                        stats.dailyUpdates[dateKey] = 0;
                    }
                    currentDate.setDate(currentDate.getDate() + 1);
                }
            }

            return stats;
        }        function createCouncilCard(name, stats, hasEnterpriseData = false) {
            const div = document.createElement('div');
            div.className = 'col-12';
            
            const freshPercent = Math.round((stats.fresh / stats.totalRecords) * 100);
            const mediumPercent = Math.round((stats.medium / stats.totalRecords) * 100);
            const oldPercent = Math.round((stats.old / stats.totalRecords) * 100);
            const noDatePercent = Math.round((stats.noDate / stats.totalRecords) * 100);

            let statusClass, statusText;
            if (freshPercent >= 70) {
                statusClass = 'freshness-good';
                statusText = '–ê–∫—Ç—É–∞–ª—å–Ω–æ';
            } else if (freshPercent + mediumPercent >= 70) {
                statusClass = 'freshness-warning';
                statusText = '–ß–∞—Å—Ç–∫–æ–≤–æ –∞–∫—Ç—É–∞–ª—å–Ω–æ';
            } else {
                statusClass = 'freshness-bad';
                statusText = '–ó–∞—Å—Ç–∞—Ä—ñ–ª–æ';
            }            const latestDate = stats.latestUpdate ? stats.latestUpdate.toLocaleDateString('uk-UA') : '–Ω–µ–º–∞—î –¥–∞–Ω–∏—Ö';
            const oldestDate = stats.oldestUpdate ? stats.oldestUpdate.toLocaleDateString('uk-UA') : '–Ω–µ–º–∞—î –¥–∞–Ω–∏—Ö';            // –û—Ç—Ä–∏–º—É—î–º–æ –∫—ñ–ª—å–∫–æ—Å—Ç—ñ —Ä–æ–∑–±—ñ–∂–Ω–æ—Å—Ç–µ–π –¥–ª—è —Ü—ñ—î—ó —Ä–∞–¥–∏ —Ç—ñ–ª—å–∫–∏ —è–∫—â–æ —î –¥–∞–Ω—ñ –ø—ñ–¥–ø—Ä–∏—î–º—Å—Ç–≤–∞
            const missingInDzkCount = hasEnterpriseData ? (councilMissingInDzk.get(name) || 0) : 0;
            const missingInRrpCount = hasEnterpriseData ? (councilMissingInRrp.get(name) || 0) : 0;

            // –î–æ–¥–∞—î–º–æ –¥–∞–Ω—ñ –≤ –æ–±–∏–¥–≤–∞ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–Ω—è
            addTableRow(name, statusClass, statusText, stats, freshPercent, mediumPercent, oldPercent, noDatePercent, latestDate, missingInDzkCount, missingInRrpCount, hasEnterpriseData);

            div.innerHTML = `
                <div class="card council-card">
                    <div class="card-body">
                        <div class="row align-items-center">
                            <div class="col-md-3">
                                <h5 class="card-title d-flex align-items-center mb-0">
                                    <i class="bi bi-geo-alt-fill me-2 ${statusClass}"></i>
                                    ${name}
                                </h5>
                            </div>
                            <div class="col-md-2">
                                <div class="text-muted">–°—Ç–∞—Ç—É—Å: <span class="${statusClass}">${statusText}</span></div>
                                <div class="small">–î—ñ–ª—è–Ω–æ–∫: ${stats.totalRecords}</div>
                            </div>
                            <div class="col-md-5">
                                <div class="progress">
                                    <div class="progress-bar bg-success" style="width: ${freshPercent}%" title="–î–æ 1 –º—ñ—Å—è—Ü—è: ${freshPercent}%">
                                        ${freshPercent}%
                                    </div>
                                    <div class="progress-bar bg-warning" style="width: ${mediumPercent}%" title="1-2 –º—ñ—Å—è—Ü—ñ: ${mediumPercent}%">
                                        ${mediumPercent}%
                                    </div>
                                    <div class="progress-bar bg-danger" style="width: ${oldPercent}%" title="–ü–æ–Ω–∞–¥ 2 –º—ñ—Å—è—Ü—ñ: ${oldPercent}%">
                                        ${oldPercent}%
                                    </div>
                                    <div class="progress-bar bg-secondary" style="width: ${noDatePercent}%" title="–ë–µ–∑ –¥–∞—Ç–∏: ${noDatePercent}%">
                                        ${noDatePercent}%
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-2">
                                <div class="small">–û–Ω–æ–≤–ª–µ–Ω–æ: ${latestDate}</div>
                            </div>
                        </div>
                        <div class="daily-updates-chart">
                            <canvas id="chart-${name}"></canvas>
                        </div>
                    </div>
                </div>
            `;

            // üöÄ LAZY LOADING –¥–ª—è –≥—Ä–∞—Ñ—ñ–∫—ñ–≤ - —Å—Ç–≤–æ—Ä—é—î–º–æ —Ç—ñ–ª—å–∫–∏ –∫–æ–ª–∏ —Å—Ç–∞—é—Ç—å –≤–∏–¥–∏–º–∏–º–∏
            const chartContainer = div.querySelector('.daily-updates-chart');
            setupLazyChart(chartContainer, `chart-${name}`, stats, name);

            return div;
        }        function addTableRow(name, statusClass, statusText, stats, freshPercent, mediumPercent, oldPercent, noDatePercent, latestDate, missingInDzkCount = 0, missingInRrpCount = 0, hasEnterpriseData = false) {
            const tbody = document.getElementById('tableBody');
            const row = document.createElement('tr');
            
            const badgeCells = hasEnterpriseData ? `
                <td class="badge-column">
                    <span class="badge ${missingInDzkCount > 0 ? 'bg-warning text-dark' : 'bg-success'}" title="${missingInDzkCount > 0 ? missingInDzkCount + ' –≤—ñ–¥—Å—É—Ç–Ω—ñ—Ö –≤ –î–ó–ö' : '–í—Å—ñ –∑–Ω–∞–π–¥–µ–Ω—ñ –≤ –î–ó–ö'}">
                        ${missingInDzkCount}
                    </span>
                </td>
                <td class="badge-column">
                    <span class="badge ${missingInRrpCount > 0 ? 'bg-warning text-dark' : 'bg-success'}" title="${missingInRrpCount > 0 ? missingInRrpCount + ' –≤—ñ–¥—Å—É—Ç–Ω—ñ—Ö –≤ –†–†–ü' : '–í—Å—ñ –∑–Ω–∞–π–¥–µ–Ω—ñ –≤ –†–†–ü'}">
                        ${missingInRrpCount}
                    </span>
                </td>
            ` : `
                <td class="badge-column" style="display: none;"></td>
                <td class="badge-column" style="display: none;"></td>
            `;
            
            row.innerHTML = `
                <td>
                    <i class="bi bi-geo-alt-fill me-2 ${statusClass}"></i>
                    ${name}
                </td>
                <td>${stats.koatuu || '–ù/–î'}</td>
                <td><span class="${statusClass}">${statusText}</span></td>
                <td>${stats.totalRecords}</td>
                <td>
                    <div class="progress">
                        <div class="progress-bar bg-success" style="width: ${freshPercent}%" title="–î–æ 1 –º—ñ—Å—è—Ü—è: ${freshPercent}%">
                            ${freshPercent}%
                        </div>
                        <div class="progress-bar bg-warning" style="width: ${mediumPercent}%" title="1-2 –º—ñ—Å—è—Ü—ñ: ${mediumPercent}%">
                            ${mediumPercent}%
                        </div>
                        <div class="progress-bar bg-danger" style="width: ${oldPercent}%" title="–ü–æ–Ω–∞–¥ 2 –º—ñ—Å—è—Ü—ñ: ${oldPercent}%">
                            ${oldPercent}%
                        </div>
                        <div class="progress-bar bg-secondary" style="width: ${noDatePercent}%" title="–ë–µ–∑ –¥–∞—Ç–∏: ${noDatePercent}%">
                            ${noDatePercent}%
                        </div>
                    </div>
                </td>
                <td>${latestDate}</td>
                ${badgeCells}
            `;
            
            tbody.appendChild(row);
        }

        // –î–æ–¥–∞—î–º–æ –ø–µ—Ä–µ–º–∏–∫–∞—á –≤–∏–¥—ñ–≤
        document.addEventListener('DOMContentLoaded', function() {
            const viewButtons = document.querySelectorAll('[data-view]');
            viewButtons.forEach(button => {
                button.addEventListener('click', function() {
                    const view = this.dataset.view;
                    document.getElementById('cardsView').style.display = view === 'cards' ? 'flex' : 'none';
                    document.getElementById('tableView').style.display = view === 'table' ? 'block' : 'none';
                    
                    // –û–Ω–æ–≤–ª—é—î–º–æ –∞–∫—Ç–∏–≤–Ω—É –∫–Ω–æ–ø–∫—É
                    viewButtons.forEach(btn => btn.classList.remove('active'));
                    this.classList.add('active');
                });
            });
        });

        // –î–æ–±–∞–≤–ª—è–µ–º —Ñ—É–Ω–∫—Ü–∏—é –¥–ª—è –≤–æ–∑–≤—Ä–∞—Ç–∞
        function goBack() {
            const urlParams = new URLSearchParams(window.location.search);
            const selectedFile = urlParams.get('file');
            
            let returnUrl = 'index.html';
            if (globalId) returnUrl += `?id=${globalId}`;
            if (selectedFile) {
                returnUrl += globalId ? '&' : '?';
                returnUrl += `return_file=${encodeURIComponent(selectedFile)}`;
            }
            
            window.location.href = returnUrl;
        }        // –î–æ–¥–∞—î–º–æ –Ω–æ–≤—É —Ñ—É–Ω–∫—Ü—ñ—é –¥–ª—è –∫–æ–ø—ñ—é–≤–∞–Ω–Ω—è –ö–û–ê–¢–£–£
        function copyKoatuuList() {
            const tableRows = document.querySelectorAll('#tableBody tr');
            const koatuuList = Array.from(tableRows)
                .map(row => row.children[1].textContent.trim())
                .filter(koatuu => koatuu !== '–ù/–î')
                .map(koatuu => {
                    // –û–±—Ä—ñ–∑–∞—î–º–æ –æ—Å—Ç–∞–Ω–Ω—ñ–π –Ω—É–ª—å —è–∫—â–æ –≤—ñ–Ω —î
                    const trimmed = koatuu.endsWith('0') ? koatuu.slice(0, -1) : koatuu;
                    return `'${trimmed}'`;
                })
                .join(',\n');

            navigator.clipboard.writeText(koatuuList).then(() => {
                // –ü–æ–∫–∞–∑—É—î–º–æ —Ç–∏–º—á–∞—Å–æ–≤–µ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –ø—Ä–æ —É—Å–ø—ñ—Ö
                const btn = document.querySelector('button[onclick="copyKoatuuList()"]');
                const originalHtml = btn.innerHTML;
                btn.innerHTML = '<i class="bi bi-check"></i> –°–∫–æ–ø—ñ–π–æ–≤–∞–Ω–æ';
                setTimeout(() => {
                    btn.innerHTML = originalHtml;
                }, 2000);
            });
        }
        
        // üöÄ –§–£–ù–ö–¶–Ü–á –î–õ–Ø –ö–ï–†–£–í–ê–ù–ù–Ø –ü–†–û–î–£–ö–¢–ò–í–ù–Ü–°–¢–Æ
        function showPerformanceStats() {
            const cacheStats = dataCache.getStats();
            const perfStats = perfMonitor.getStats();
            
            const modal = document.createElement('div');
            modal.className = 'modal fade';
            modal.innerHTML = `
                <div class="modal-dialog modal-lg">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h5 class="modal-title">
                                <i class="bi bi-speedometer2 me-2"></i>
                                –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø—Ä–æ–¥—É–∫—Ç–∏–≤–Ω–æ—Å—Ç—ñ
                            </h5>
                            <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                        </div>
                        <div class="modal-body">
                            <div class="row">
                                <div class="col-md-6">
                                    <h6 class="text-primary">üìä –ö–µ—à</h6>
                                    <div class="bg-light p-3 rounded mb-3">
                                        <div><strong>Hit Rate:</strong> ${cacheStats.hitRate}%</div>
                                        <div><strong>Hits:</strong> ${cacheStats.hits}</div>
                                        <div><strong>Misses:</strong> ${cacheStats.misses}</div>
                                        <div><strong>Errors:</strong> ${cacheStats.errors}</div>
                                        <div><strong>Cache Size:</strong> ${cacheStats.cacheSize} items</div>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <h6 class="text-success">‚ö° –ß–∞—Å –≤–∏–∫–æ–Ω–∞–Ω–Ω—è</h6>
                                    <div class="bg-light p-3 rounded mb-3" style="max-height: 300px; overflow-y: auto;">
                                        ${Object.entries(perfStats).map(([label, data]) => `
                                            <div class="mb-2">
                                                <strong>${label}:</strong><br>
                                                <small>
                                                    Avg: ${data.avg}ms | 
                                                    Calls: ${data.calls} | 
                                                    Total: ${data.total}ms
                                                </small>
                                            </div>
                                        `).join('')}
                                    </div>
                                </div>
                            </div>
                            
                            <div class="alert alert-info">
                                <h6>üí° –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü—ñ—ó:</h6>
                                <ul class="mb-0">
                                    <li>Hit Rate > 70% - –¥–æ–±—Ä–∞ –µ—Ñ–µ–∫—Ç–∏–≤–Ω—ñ—Å—Ç—å –∫–µ—à—É</li>
                                    <li>–ß–∞—Å –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è < 2—Å–µ–∫ - —Ö–æ—Ä–æ—à–∞ —à–≤–∏–¥–∫—ñ—Å—Ç—å</li>
                                    <li>–ü—Ä–∏ –Ω–∏–∑—å–∫–æ–º—É Hit Rate - –æ—á–∏—Å—Ç—ñ—Ç—å –∫–µ—à</li>
                                </ul>
                            </div>
                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">–ó–∞–∫—Ä–∏—Ç–∏</button>
                            <button type="button" class="btn btn-warning" onclick="clearCache(); bootstrap.Modal.getInstance(this.closest('.modal')).hide();">
                                –û—á–∏—Å—Ç–∏—Ç–∏ –∫–µ—à
                            </button>
                        </div>
                    </div>
                </div>
            `;
            
            document.body.appendChild(modal);
            const bsModal = new bootstrap.Modal(modal);
            bsModal.show();
            
            modal.addEventListener('hidden.bs.modal', () => {
                document.body.removeChild(modal);
            });
        }
        
        function clearCache() {
            dataCache.clear();
            perfMonitor.metrics.clear();
            
            showSuccessMessage('–ö–µ—à –æ—á–∏—â–µ–Ω–æ! –ù–∞—Å—Ç—É–ø–Ω–µ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –±—É–¥–µ –ø–æ–≤—ñ–ª—å–Ω—ñ—à–∏–º, –∞–ª–µ –∑ –Ω–∞–π—Å–≤—ñ–∂—ñ—à–∏–º–∏ –¥–∞–Ω–∏–º–∏.');
        }
        
        function reloadWithNoCache() {
            // –û—á–∏—â—É—î–º–æ –∫–µ—à –±—Ä–∞—É–∑–µ—Ä–∞ –¥–ª—è —Ü—ñ—î—ó —Å—Ç–æ—Ä—ñ–Ω–∫–∏
            if ('caches' in window) {
                caches.keys().then(names => {
                    names.forEach(name => {
                        caches.delete(name);
                    });
                });
            }
            
            clearCache();
            
            // –ü–µ—Ä–µ–∑–∞–≤–∞–Ω—Ç–∞–∂—É—î–º–æ —Å—Ç–æ—Ä—ñ–Ω–∫—É –∑ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–º –¥–ª—è –æ–±—Ö–æ–¥—É –∫–µ—à—É
            const url = new URL(window.location);
            url.searchParams.set('nocache', Date.now());
            window.location.href = url.toString();
        }
        
        function showSuccessMessage(message) {
            const alert = document.createElement('div');
            alert.className = 'alert alert-success alert-dismissible fade show position-fixed';
            alert.style.cssText = 'top: 20px; right: 20px; z-index: 10000; max-width: 400px;';
            alert.innerHTML = `
                <i class="bi bi-check-circle-fill me-2"></i>
                ${message}
                <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
            `;
            document.body.appendChild(alert);
            
            setTimeout(() => {
                if (alert.parentNode) {
                    alert.remove();
                }
            }, 5000);
        }
    </script>
</body>
</html>
